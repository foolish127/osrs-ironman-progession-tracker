<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FoolinSlays - Ironman Tracker</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Fira+Code:wght@400;500&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
    <style>
        :root {
            --bg-dark: #0d1117;
            --bg-card: #161b22;
            --bg-card-hover: #1c2129;
            --border: #30363d;
            --text-primary: #e6edf3;
            --text-secondary: #8b949e;
            --text-muted: #6e7681;
            --accent-gold: #d4a84b;
            --accent-gold-dim: #8a6a2a;
            --accent-green: #3fb950;
            --accent-blue: #58a6ff;
            --accent-red: #f85149;
            --accent-purple: #a371f7;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: var(--bg-dark); color: var(--text-primary); min-height: 100vh; line-height: 1.6; }
        .container { max-width: 1400px; margin: 0 auto; padding: 2rem; }
        header { text-align: center; margin-bottom: 3rem; padding: 2rem 0; border-bottom: 1px solid var(--border); position: relative; }
        header::after { content: ''; position: absolute; bottom: -1px; left: 50%; transform: translateX(-50%); width: 200px; height: 2px; background: linear-gradient(90deg, transparent, var(--accent-gold), transparent); }
        .player-name { font-family: 'Cinzel', serif; font-size: 3rem; font-weight: 700; color: var(--accent-gold); letter-spacing: 0.05em; margin-bottom: 0.5rem; }
        .account-type { display: inline-flex; align-items: center; gap: 0.5rem; font-family: 'Fira Code', monospace; font-size: 0.875rem; color: var(--text-secondary); padding: 0.25rem 1rem; border: 1px solid var(--border); border-radius: 4px; background: var(--bg-card); }
        .account-type .iron-icon { width: 16px; height: 16px; }
        .last-updated { margin-top: 1rem; font-size: 0.8rem; color: var(--text-secondary); background: var(--bg-card); display: inline-block; padding: 0.25rem 0.75rem; border-radius: 4px; }
        .stats-overview { display: grid; grid-template-columns: repeat(6, 1fr); gap: 1rem; margin-bottom: 3rem; max-width: 1050px; margin-left: auto; margin-right: auto; }
        .stat-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 6px; padding: 1.25rem; text-align: center; min-width: 120px; flex: 0 1 auto; cursor: pointer; transition: all 0.2s ease; }
        .stat-card:hover { background: var(--bg-card-hover); border-color: var(--accent-gold); transform: translateY(-2px); }
        .stat-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--text-muted); margin-bottom: 0.5rem; }
        .stat-value { font-family: 'Fira Code', monospace; font-size: 1.5rem; font-weight: 500; }
        .stat-value.gold { color: var(--accent-gold); }
        .stat-value.green { color: var(--accent-green); }
        .stat-value.blue { color: var(--accent-blue); }
        .stat-value.purple { color: var(--accent-purple); }
        .nav-tabs { display: flex; gap: 0; margin-bottom: 2rem; border-bottom: 1px solid var(--border); overflow-x: auto; }
        .nav-tab { padding: 1rem 1.5rem; font-size: 0.875rem; font-weight: 500; color: var(--text-secondary); background: transparent; border: none; cursor: pointer; position: relative; white-space: nowrap; }
        .nav-tab:hover { color: var(--text-primary); }
        .nav-tab.active { color: var(--accent-gold); }
        .nav-tab.active::after { content: ''; position: absolute; bottom: -1px; left: 0; right: 0; height: 2px; background: var(--accent-gold); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .skills-grid { display: grid; grid-template-columns: repeat(3, minmax(160px, 220px)); gap: 0.5rem; justify-content: center; max-width: 720px; margin: 0 auto; }
        .skill-item { background: var(--bg-card); border: 1px solid var(--border); border-radius: 4px; padding: 0.6rem 0.75rem; display: flex; align-items: center; gap: 0.6rem; }
        .skill-item.maxed { border-color: var(--accent-gold); }
        .skill-icon { width: 24px; height: 24px; object-fit: contain; }
        .skill-info { flex: 1; min-width: 0; }
        .skill-name { font-size: 0.75rem; color: var(--text-secondary); }
        .skill-level { font-family: 'Fira Code', monospace; font-size: 1.1rem; font-weight: 500; }
        .skill-level.maxed { color: var(--accent-gold); }
        .skill-xp { font-family: 'Fira Code', monospace; font-size: 0.65rem; color: var(--text-muted); }
        .skill-progress { height: 4px; background: var(--border); border-radius: 2px; margin-top: 4px; overflow: hidden; }
        .skill-progress-fill { height: 100%; border-radius: 2px; transition: width 0.5s ease; }
        .skill-progress-fill.low { background: var(--accent-red); }
        .skill-progress-fill.mid { background: var(--accent-gold); }
        .skill-progress-fill.high { background: var(--accent-green); }
        .boss-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 0.5rem; }
        .boss-item { background: var(--bg-card); border: 1px solid var(--border); border-radius: 4px; padding: 0.6rem 0.75rem; display: flex; justify-content: space-between; align-items: center; height: 42px; }
        .boss-bar-chart { margin-bottom: 2rem; }
        .boss-bar-chart h3 { font-size: 0.9rem; color: var(--text-muted); margin-bottom: 1rem; text-transform: uppercase; letter-spacing: 0.05em; }
        .boss-bar { display: flex; align-items: center; margin-bottom: 0.4rem; }
        .boss-bar-name { width: 180px; font-size: 0.8rem; color: var(--text-secondary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; flex-shrink: 0; }
        .boss-bar-track { flex: 1; height: 20px; background: var(--bg-card); border-radius: 3px; overflow: hidden; margin: 0 0.75rem; }
        .boss-bar-fill { height: 100%; background: linear-gradient(90deg, var(--accent-gold), #e5b95c); border-radius: 3px; transition: width 0.3s ease; }
        .boss-bar-kc { font-family: 'Fira Code', monospace; font-size: 0.75rem; color: var(--text-muted); width: 70px; text-align: right; flex-shrink: 0; }
        .boss-name { font-size: 0.8rem; color: var(--text-secondary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; flex: 1; margin-right: 0.5rem; }
        .boss-kc { font-family: 'Fira Code', monospace; font-size: 0.9rem; color: var(--accent-gold); }
        .clues-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 0.5rem; }
        .clue-item { background: var(--bg-card); border: 1px solid var(--border); border-radius: 4px; padding: 0.6rem 0.75rem; display: flex; justify-content: space-between; align-items: center; }
        .clue-item.beginner { border-left: 3px solid #8b8b8b; }
        .clue-item.easy { border-left: 3px solid #3fb950; }
        .clue-item.medium { border-left: 3px solid #58a6ff; }
        .clue-item.hard { border-left: 3px solid #a371f7; }
        .clue-item.elite { border-left: 3px solid #d4a84b; }
        .clue-item.master { border-left: 3px solid #f85149; }
        .clue-item.all { border-left: 3px solid #e6edf3; }
        .clue-name { font-size: 0.8rem; color: var(--text-secondary); }
        .clue-count { font-family: 'Fira Code', monospace; font-size: 0.9rem; color: var(--accent-gold); }
        .progress-section { background: var(--bg-card); border: 1px solid var(--border); border-radius: 6px; padding: 1.5rem; margin-bottom: 1.5rem; }
        .progress-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem; }
        .progress-title { font-size: 1rem; font-weight: 500; }
        .progress-stats { font-family: 'Fira Code', monospace; font-size: 0.9rem; }
        .progress-stats .obtained { color: var(--accent-green); }
        .progress-stats .total { color: var(--text-muted); }
        .progress-bar { height: 12px; background: var(--border); border-radius: 6px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--accent-gold-dim), var(--accent-gold)); border-radius: 6px; transition: width 0.5s ease; }
        .progress-percentage { font-family: 'Fira Code', monospace; font-size: 0.8rem; color: var(--text-muted); margin-top: 0.5rem; text-align: center; }
        .tier-rewards { font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid var(--border); }
        .rewards-label { color: var(--text-muted); margin-right: 0.5rem; }
        .tier-overview { margin: 1.5rem 0; }
        .tier-overview-title { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; }
        .tier-overview-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 0.5rem; }
        .tier-badge { background: var(--bg-card); border: 1px solid var(--border); border-radius: 6px; padding: 0.75rem; text-align: center; position: relative; opacity: 0.5; }
        .tier-badge.unlocked { opacity: 1; background: rgba(255,255,255,0.03); }
        .tier-badge-name { display: block; font-weight: 600; font-size: 0.85rem; margin-bottom: 0.25rem; }
        .tier-badge-points { font-family: 'Fira Code', monospace; font-size: 0.75rem; color: var(--text-muted); }
        .tier-badge-check { position: absolute; top: 0.25rem; right: 0.5rem; color: var(--accent-green); font-size: 0.75rem; }
        .search-filter { display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap; }
        .search-input { flex: 1; min-width: 200px; padding: 0.75rem 1rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 4px; color: var(--text-primary); font-size: 0.9rem; }
        .search-input:focus { outline: none; border-color: var(--accent-gold); }
        .filter-select { padding: 0.75rem 1rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 4px; color: var(--text-primary); font-size: 0.9rem; }
        .collection { background: var(--bg-card); border: 1px solid var(--border); border-radius: 6px; margin-bottom: 0.75rem; overflow: hidden; }
        .collection-header { padding: 1rem; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .collection-header:hover { background: var(--bg-card-hover); }
        .collection-name { font-weight: 500; font-size: 0.95rem; }
        .collection-count { font-family: 'Fira Code', monospace; font-size: 0.85rem; }
        .collection-count .obtained { color: var(--accent-green); }
        .collection-count .total { color: var(--text-muted); }
        .collection-items { display: none; padding: 0.75rem 1rem; border-top: 1px solid var(--border); background: var(--bg-dark); }
        .collection.expanded .collection-items { display: block; }
        .item-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 0.25rem; }
        .item { font-size: 0.8rem; padding: 0.35rem 0.5rem; border-radius: 3px; display: flex; align-items: center; gap: 0.5rem; }
        .item.obtained { color: var(--accent-green); }
        .item.missing { color: var(--text-muted); }
        .item-check { width: 16px; font-size: 0.75rem; flex-shrink: 0; }
        .item-name { flex: 1; }
        .item-date { font-family: 'Fira Code', monospace; font-size: 0.7rem; color: var(--text-muted); }
        .ca-tier { background: var(--bg-card); border: 1px solid var(--border); border-radius: 6px; margin-bottom: 0.75rem; overflow: hidden; }
        .ca-tier-header { padding: 1rem; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .ca-tier-header:hover { background: var(--bg-card-hover); }
        .ca-tier-name { font-weight: 600; text-transform: capitalize; }
        .ca-tier-name.easy { color: #3fb950; }
        .ca-tier-name.medium { color: #58a6ff; }
        .ca-tier-name.hard { color: #a371f7; }
        .ca-tier-name.elite { color: #d4a84b; }
        .ca-tier-name.master { color: #f85149; }
        .ca-tier-name.grandmaster { color: #ff7b72; }
        .ca-tier-stats { font-family: 'Fira Code', monospace; font-size: 0.85rem; display: flex; gap: 1.5rem; align-items: center; }
        .ca-tier-progress { width: 100px; height: 6px; background: var(--border); border-radius: 3px; overflow: hidden; }
        .ca-tier-progress-fill { height: 100%; border-radius: 3px; }
        .ca-tier-tasks { display: none; padding: 0.75rem 1rem; border-top: 1px solid var(--border); background: var(--bg-dark); }
        .ca-tier.expanded .ca-tier-tasks { display: block; }
        .pets-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 0.75rem; }
        .pet-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 6px; padding: 1rem; text-align: center; }
        .pet-card.obtained { border-color: var(--accent-green); background: rgba(63, 185, 80, 0.1); }
        .pet-card.missing { opacity: 0.6; }
        .pet-name { font-weight: 500; margin-bottom: 0.25rem; }
        .pet-card.obtained .pet-name { color: var(--accent-green); }
        .pet-source { font-size: 0.8rem; color: var(--text-muted); }
        .pet-date { font-family: 'Fira Code', monospace; font-size: 0.75rem; color: var(--accent-gold); margin-top: 0.5rem; }
        .recent-activity { margin-bottom: 2rem; }
        .recent-title { font-size: 1rem; font-weight: 500; margin-bottom: 1rem; color: var(--text-secondary); }
        .recent-list { display: flex; flex-direction: column; gap: 0.5rem; }
        .recent-item { background: var(--bg-card); border: 1px solid var(--border); border-radius: 4px; padding: 0.75rem 1rem; display: flex; justify-content: space-between; align-items: center; }
        .recent-item-name { color: var(--accent-green); }
        .recent-item-source { font-size: 0.8rem; color: var(--text-muted); }
        .recent-item-date { font-family: 'Fira Code', monospace; font-size: 0.8rem; color: var(--accent-gold); }
        /* Collection Log Overview */
        .clog-overview { background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; padding: 1.5rem; margin-bottom: 1.5rem; }
        .clog-overview-title { font-family: 'Cinzel', serif; font-size: 1.1rem; color: var(--accent-gold); text-align: center; margin-bottom: 1.25rem; letter-spacing: 0.05em; }
        .clog-categories { display: grid; grid-template-columns: repeat(5, 1fr); gap: 0.75rem; margin-bottom: 1.25rem; }
        @media (max-width: 768px) { .clog-categories { grid-template-columns: repeat(3, 1fr); } }
        @media (max-width: 480px) { .clog-categories { grid-template-columns: repeat(2, 1fr); } }
        .clog-category { background: var(--bg-dark); border: 1px solid var(--border); border-radius: 6px; padding: 0.75rem; text-align: center; }
        .clog-category-icon { font-size: 1.5rem; margin-bottom: 0.25rem; }
        .clog-category-name { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.25rem; }
        .clog-category-count { font-family: 'Fira Code', monospace; font-size: 1rem; color: var(--text-primary); }
        .clog-category-count .obtained { color: var(--accent-green); }
        .clog-category-bar { height: 4px; background: var(--border); border-radius: 2px; margin-top: 0.5rem; overflow: hidden; }
        .clog-category-bar-fill { height: 100%; background: var(--accent-gold); border-radius: 2px; }
        .clog-total { background: var(--bg-dark); border: 1px solid var(--border); border-radius: 6px; padding: 0.75rem 1.5rem; margin-bottom: 1.25rem; }
        .clog-total-bar { height: 28px; background: #4a4a4a; border-radius: 4px; overflow: hidden; position: relative; }
        .clog-total-bar-fill { height: 100%; background: linear-gradient(90deg, #2d8a3e, #3fb950); border-radius: 4px 0 0 4px; }
        .clog-total-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-family: 'Fira Code', monospace; font-size: 0.95rem; color: #fff; font-weight: 600; text-shadow: 1px 1px 2px rgba(0,0,0,0.8); }
        .clog-latest { border-top: 1px solid var(--border); padding-top: 1rem; }
        .clog-latest-title { font-size: 0.8rem; color: var(--text-muted); text-align: center; margin-bottom: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; }
        .clog-latest-items { display: flex; justify-content: center; gap: 0.5rem; flex-wrap: wrap; }
        .clog-latest-item { background: var(--bg-dark); border: 1px solid var(--border); border-radius: 4px; padding: 0.4rem; width: 42px; height: 42px; display: flex; align-items: center; justify-content: center; }
        .clog-latest-item img { max-width: 32px; max-height: 32px; image-rendering: pixelated; }
        .clog-latest-item:hover { border-color: var(--accent-gold); }
        .kanban-board { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; }
        @media (max-width: 1000px) { .kanban-board { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 600px) { .kanban-board { grid-template-columns: 1fr; } }
        .kanban-column { background: var(--bg-dark); border-radius: 8px; padding: 1rem; min-height: 300px; }
        .kanban-header { font-size: 0.85rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; padding-bottom: 0.75rem; margin-bottom: 0.75rem; border-bottom: 2px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .kanban-header .count { background: var(--bg-card); padding: 0.2rem 0.5rem; border-radius: 10px; font-size: 0.75rem; }
        .kanban-column.backlog .kanban-header { color: #9ca3af; border-color: #4b5563; }
        .kanban-column.in-progress .kanban-header { color: #60a5fa; border-color: #3b82f6; }
        .kanban-column.blocked .kanban-header { color: #f87171; border-color: #ef4444; }
        .kanban-column.completed .kanban-header { color: #4ade80; border-color: #22c55e; }
        .kanban-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 6px; padding: 0.75rem; margin-bottom: 0.5rem; cursor: default; transition: transform 0.1s, box-shadow 0.1s; }
        .kanban-card:hover { transform: translateY(-1px); box-shadow: 0 2px 8px rgba(0,0,0,0.3); }
        .kanban-card .card-title { font-size: 0.9rem; margin-bottom: 0.25rem; }
        .kanban-card .card-date { font-size: 0.75rem; color: var(--text-muted); }
        .kanban-column.completed .kanban-card { opacity: 0.8; }
        .kanban-column.completed .card-title { text-decoration: line-through; color: var(--text-muted); }
        .kanban-empty { color: var(--text-muted); font-size: 0.85rem; font-style: italic; text-align: center; padding: 2rem 1rem; }
        
        /* Diaries */
        .diaries-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1rem; }
        .diary-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; overflow: hidden; }
        .diary-header { padding: 0.75rem 1rem; font-weight: 600; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .diary-header .diary-count { font-size: 0.8rem; font-weight: normal; color: var(--text-muted); }
        .diary-tiers { display: grid; grid-template-columns: repeat(4, 1fr); }
        .diary-tier { padding: 0.75rem 0.5rem; text-align: center; border-right: 1px solid var(--border); }
        .diary-tier:last-child { border-right: none; }
        .diary-tier .tier-name { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.25rem; }
        .diary-tier.easy .tier-name { color: #22c55e; }
        .diary-tier.medium .tier-name { color: #eab308; }
        .diary-tier.hard .tier-name { color: #f97316; }
        .diary-tier.elite .tier-name { color: #06b6d4; }
        .diary-tier .tier-status { font-size: 1.1rem; }
        .diary-tier.completed { background: rgba(74, 222, 128, 0.1); }
        .diary-tier.completed .tier-status { color: #4ade80; }
        .diary-tier:not(.completed) .tier-status { color: var(--text-muted); }
        .diaries-summary { display: flex; gap: 2rem; justify-content: center; margin-bottom: 1.5rem; flex-wrap: wrap; }
        .diaries-summary .summary-item { text-align: center; }
        .diaries-summary .summary-value { font-size: 1.5rem; font-weight: 600; }
        .diaries-summary .summary-label { font-size: 0.8rem; color: var(--text-muted); }
        .remaining-tasks { margin-top: 2rem; }
        .remaining-tasks-header { display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px 8px 0 0; cursor: pointer; }
        .remaining-tasks-header:hover { background: var(--bg-dark); }
        .remaining-tasks-header h3 { margin: 0; font-size: 1rem; }
        .remaining-tasks-header .toggle { color: var(--text-muted); }
        .remaining-tasks-list { display: none; border: 1px solid var(--border); border-top: none; border-radius: 0 0 8px 8px; overflow: hidden; }
        .remaining-tasks.expanded .remaining-tasks-list { display: block; }
        .remaining-tasks.expanded .toggle { transform: rotate(180deg); }
        .task-region { border-bottom: 1px solid var(--border); }
        .task-region:last-child { border-bottom: none; }
        .task-region-header { padding: 0.75rem 1rem; background: var(--bg-card); font-weight: 600; display: flex; justify-content: space-between; align-items: center; }
        .task-region-header .task-count { font-size: 0.8rem; font-weight: normal; color: var(--text-muted); }
        .task-items { background: var(--bg-dark); }
        .task-item { padding: 0.5rem 1rem 0.5rem 1.5rem; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; font-size: 0.9rem; }
        .task-item:last-child { border-bottom: none; }
        .task-item .task-tier { font-size: 0.75rem; padding: 0.15rem 0.5rem; border-radius: 3px; }
        .task-item .task-tier.medium { background: rgba(234, 179, 8, 0.2); color: #eab308; }
        .task-item .task-tier.hard { background: rgba(249, 115, 22, 0.2); color: #f97316; }
        .task-item .task-tier.elite { background: rgba(6, 182, 212, 0.2); color: #06b6d4; }
        
        /* B0aty Guide */
        .boaty-header { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; margin-bottom: 1.5rem; }
        .boaty-progress { display: flex; gap: 2rem; flex-wrap: wrap; }
        .boaty-progress .progress-item { text-align: center; }
        .boaty-progress .progress-value { font-size: 1.5rem; font-weight: 600; }
        .boaty-progress .progress-label { font-size: 0.8rem; color: var(--text-muted); }
        .boaty-progress-bar { width: 100%; height: 8px; background: var(--bg-dark); border-radius: 4px; overflow: hidden; margin-top: 0.5rem; }
        .boaty-progress-fill { height: 100%; background: linear-gradient(90deg, var(--accent-green), #22c55e); border-radius: 4px; transition: width 0.3s; }
        .boaty-controls { display: flex; gap: 1rem; flex-wrap: wrap; margin-bottom: 1rem; }
        .boaty-search { flex: 1; min-width: 200px; padding: 0.75rem 1rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 6px; color: var(--text-primary); font-size: 0.9rem; }
        .boaty-search:focus { outline: none; border-color: var(--accent-gold); }
        .boaty-filters { display: flex; gap: 0.5rem; flex-wrap: wrap; }
        .boaty-filter { padding: 0.5rem 1rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 4px; color: var(--text-muted); cursor: pointer; font-size: 0.85rem; }
        .boaty-filter:hover { border-color: var(--text-muted); }
        .boaty-filter.active { background: var(--accent-gold); color: var(--bg-dark); border-color: var(--accent-gold); }
        .boaty-episode { margin-bottom: 1rem; }
        .boaty-episode-header { background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px 8px 0 0; padding: 1rem; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .boaty-episode-header:hover { background: var(--bg-card-hover); }
        .boaty-episode-header h3 { margin: 0; font-size: 1rem; }
        .boaty-episode-header .episode-stats { display: flex; gap: 1rem; align-items: center; }
        .boaty-episode-header .episode-progress { font-size: 0.85rem; color: var(--text-muted); }
        .boaty-episode-header .episode-toggle { color: var(--text-muted); transition: transform 0.2s; }
        .boaty-episode.expanded .episode-toggle { transform: rotate(180deg); }
        .boaty-episode-content { display: none; border: 1px solid var(--border); border-top: none; border-radius: 0 0 8px 8px; }
        .boaty-episode.expanded .boaty-episode-content { display: block; }
        .boaty-section { border-bottom: 1px solid var(--border); }
        .boaty-section:last-child { border-bottom: none; }
        .boaty-section-header { padding: 0.75rem 1rem; background: var(--bg-card); font-weight: 500; display: flex; justify-content: space-between; cursor: pointer; }
        .boaty-section-header:hover { background: rgba(212, 168, 75, 0.1); }
        .boaty-section-header .section-count { font-size: 0.8rem; color: var(--text-muted); font-weight: normal; }
        .boaty-withdraw { padding: 0.5rem 1rem; background: rgba(6, 182, 212, 0.1); font-size: 0.8rem; color: #06b6d4; border-bottom: 1px solid var(--border); }
        .boaty-steps { background: var(--bg-dark); }
        .boaty-step { padding: 0.5rem 1rem; border-bottom: 1px solid var(--border); display: flex; align-items: flex-start; gap: 0.75rem; font-size: 0.9rem; cursor: pointer; transition: background 0.15s; }
        .boaty-step:last-child { border-bottom: none; }
        .boaty-step:hover { background: var(--bg-card); }
        .boaty-step.completed { background: rgba(74, 222, 128, 0.05); }
        .boaty-step .step-checkbox { width: 20px; height: 20px; border: 2px solid var(--border); border-radius: 4px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; font-size: 0.8rem; margin-top: 2px; }
        .boaty-step.completed .step-checkbox { background: var(--accent-green); border-color: var(--accent-green); color: var(--bg-dark); }
        .boaty-step .step-id { color: var(--text-muted); font-size: 0.75rem; min-width: 35px; margin-top: 2px; }
        .boaty-step .step-text { flex: 1; }
        .boaty-step.completed .step-text { text-decoration: line-through; color: var(--text-muted); }
        .boaty-step .step-date { font-size: 0.75rem; color: var(--text-muted); }
        .boaty-empty { text-align: center; padding: 2rem; color: var(--text-muted); }
        .empty-state { text-align: center; padding: 3rem; color: var(--text-muted); }
        /* Bank Styles */
        .bank-summary { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
        .bank-summary-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 6px; padding: 1.25rem; text-align: center; }
        .bank-summary-card.highlight { border-color: var(--accent-gold); background: rgba(212, 168, 75, 0.05); }
        .bank-summary-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--text-muted); margin-bottom: 0.5rem; }
        .bank-summary-value { font-family: 'Fira Code', monospace; font-size: 1.5rem; font-weight: 500; color: var(--accent-gold); }
        .bank-summary-value.green { color: var(--accent-green); }
        .bank-top-items { background: var(--bg-card); border: 1px solid var(--border); border-radius: 6px; padding: 1rem; margin-bottom: 2rem; }
        .bank-top-items h3 { font-size: 0.9rem; color: var(--text-muted); margin-bottom: 1rem; text-transform: uppercase; letter-spacing: 0.05em; }
        .top-item { display: flex; justify-content: space-between; align-items: center; padding: 0.5rem 0; border-bottom: 1px solid var(--border); }
        .top-item:last-child { border-bottom: none; }
        .top-item-name { font-size: 0.85rem; color: var(--text-primary); }
        .top-item-qty { font-family: 'Fira Code', monospace; font-size: 0.75rem; color: var(--text-muted); margin-left: 0.5rem; }
        .top-item-value { font-family: 'Fira Code', monospace; font-size: 0.85rem; color: var(--accent-gold); }
        .bank-filters { display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap; align-items: center; }
        .bank-search { flex: 1; min-width: 200px; padding: 0.75rem 1rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 4px; color: var(--text-primary); font-size: 0.9rem; }
        .bank-search:focus { outline: none; border-color: var(--accent-gold); }
        .bank-filter-select { padding: 0.75rem 1rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 4px; color: var(--text-primary); font-size: 0.9rem; min-width: 150px; }
        .bank-categories { margin-bottom: 1.5rem; }
        .bank-category { background: var(--bg-card); border: 1px solid var(--border); border-radius: 6px; margin-bottom: 0.75rem; overflow: hidden; }
        .bank-category-header { padding: 0.75rem 1rem; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .bank-category-header:hover { background: var(--bg-card-hover); }
        .bank-category-name { font-weight: 500; font-size: 0.9rem; }
        .bank-category-stats { font-family: 'Fira Code', monospace; font-size: 0.8rem; color: var(--text-muted); }
        .bank-category-value { color: var(--accent-gold); margin-left: 1rem; }
        .bank-category-items { display: none; padding: 0.5rem; border-top: 1px solid var(--border); background: var(--bg-dark); }
        .bank-category.expanded .bank-category-items { display: block; }
        .bank-items-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 0.25rem; }
        .bank-item { font-size: 0.8rem; padding: 0.4rem 0.6rem; border-radius: 3px; display: flex; justify-content: space-between; align-items: center; background: var(--bg-card); }
        .bank-item:hover { background: var(--bg-card-hover); }
        .bank-item-name { color: var(--text-secondary); flex: 1; }
        .bank-item-qty { font-family: 'Fira Code', monospace; color: var(--text-muted); margin: 0 0.5rem; }
        .bank-item-value { font-family: 'Fira Code', monospace; color: var(--accent-gold); min-width: 70px; text-align: right; }
        .bank-updated { font-size: 0.75rem; color: var(--text-muted); margin-bottom: 1rem; display: flex; flex-wrap: wrap; gap: 0.5rem 1.5rem; }
        .bank-all-items { background: var(--bg-card); border: 1px solid var(--border); border-radius: 6px; padding: 1rem; }
        .bank-all-items h3 { font-size: 0.9rem; color: var(--text-muted); margin-bottom: 1rem; text-transform: uppercase; letter-spacing: 0.05em; }
        .no-results { text-align: center; padding: 2rem; color: var(--text-muted); }
        .bank-filter-stats { display: none; margin-bottom: 1rem; }
        .filter-stats-row { display: flex; gap: 1.5rem; padding: 0.75rem 1rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 4px; font-size: 0.85rem; color: var(--text-secondary); }
        .filter-stat strong { color: var(--accent-gold); }
        .bank-category-breakdown { margin-bottom: 2rem; }
        .bank-category-breakdown h3 { font-size: 0.9rem; color: var(--text-muted); margin-bottom: 1rem; text-transform: uppercase; letter-spacing: 0.05em; }
        .category-cards { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 0.75rem; }
        .category-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 6px; padding: 1rem; cursor: pointer; transition: all 0.2s; border-left: 4px solid var(--border); }
        .category-card:hover { background: var(--bg-card-hover); transform: translateY(-2px); }
        .category-card.active { border-color: var(--accent-gold); background: rgba(212, 168, 75, 0.05); }
        .category-card-name { font-size: 0.85rem; font-weight: 500; margin-bottom: 0.5rem; color: var(--text-primary); }
        .category-card-stats { display: flex; justify-content: space-between; font-family: 'Fira Code', monospace; font-size: 0.75rem; }
        .category-card-count { color: var(--text-muted); }
        .category-card-value { color: var(--accent-gold); }
        .category-card.cat-food { border-left-color: #22c55e; }
        .category-card.cat-food .category-card-name { color: #22c55e; }
        .category-card.cat-potions { border-left-color: #3b82f6; }
        .category-card.cat-potions .category-card-name { color: #3b82f6; }
        .category-card.cat-runes { border-left-color: #a855f7; }
        .category-card.cat-runes .category-card-name { color: #a855f7; }
        .category-card.cat-equipment { border-left-color: #ef4444; }
        .category-card.cat-equipment .category-card-name { color: #ef4444; }
        .category-card.cat-ammunition { border-left-color: #f97316; }
        .category-card.cat-ammunition .category-card-name { color: #f97316; }
        .category-card.cat-skilling { border-left-color: #eab308; }
        .category-card.cat-skilling .category-card-name { color: #eab308; }
        .category-card.cat-teleportation { border-left-color: #06b6d4; }
        .category-card.cat-teleportation .category-card-name { color: #06b6d4; }
        .category-card.cat-barrows { border-left-color: #6366f1; }
        .category-card.cat-barrows .category-card-name { color: #6366f1; }
        .category-card.cat-moon-armor { border-left-color: #ec4899; }
        .category-card.cat-moon-armor .category-card-name { color: #ec4899; }
        .category-card.cat-slayer { border-left-color: #84cc16; }
        .category-card.cat-slayer .category-card-name { color: #84cc16; }
        .category-card.cat-currency { border-left-color: #fbbf24; }
        .category-card.cat-currency .category-card-name { color: #fbbf24; }
        .category-card.cat-clue-items { border-left-color: #14b8a6; }
        .category-card.cat-clue-items .category-card-name { color: #14b8a6; }
        .category-card.cat-miscellaneous { border-left-color: #6b7280; }
        .category-card.cat-miscellaneous .category-card-name { color: #6b7280; }
        .category-card.cat-quest-items { border-left-color: #8b5cf6; }
        .category-card.cat-quest-items .category-card-name { color: #8b5cf6; }
        /* Drops Tab */
        .drops-summary { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-bottom: 1.5rem; }
        .drops-stat { background: var(--bg-card); border: 1px solid var(--border); border-radius: 6px; padding: 1rem; text-align: center; }
        .drops-stat-value { font-family: 'Fira Code', monospace; font-size: 1.5rem; color: var(--accent-gold); }
        .drops-stat-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--text-muted); margin-top: 0.25rem; }
        .drops-filters { display: flex; gap: 1rem; margin-bottom: 1rem; flex-wrap: wrap; }
        .drops-search { flex: 1; min-width: 200px; padding: 0.75rem 1rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 4px; color: var(--text-primary); font-size: 0.9rem; }
        .drops-search:focus { outline: none; border-color: var(--accent-gold); }
        .drops-filter-select { padding: 0.75rem 1rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 4px; color: var(--text-primary); font-size: 0.9rem; min-width: 150px; }
        .drops-table-container { background: var(--bg-card); border: 1px solid var(--border); border-radius: 6px; overflow: hidden; margin-bottom: 2rem; }
        .drops-table { width: 100%; border-collapse: collapse; }
        .drops-table th { text-align: left; padding: 0.75rem 1rem; background: var(--bg-dark); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-muted); border-bottom: 1px solid var(--border); }
        .drops-table td { padding: 0.6rem 1rem; border-bottom: 1px solid var(--border); font-size: 0.85rem; }
        .drops-table tr:last-child td { border-bottom: none; }
        .drops-table tr:hover { background: var(--bg-card-hover); }
        .drops-table .boss-col { color: var(--text-secondary); }
        .drops-table .kc-col { font-family: 'Fira Code', monospace; color: var(--text-muted); text-align: right; }
        .drops-table .item-col { color: var(--accent-gold); font-weight: 500; }
        .drops-table .date-col { font-family: 'Fira Code', monospace; color: var(--text-muted); font-size: 0.8rem; }
        .drops-table .date-col.missing { color: var(--accent-red); opacity: 0.6; }
        .drops-table .notes-col { color: var(--text-secondary); font-size: 0.8rem; font-style: italic; max-width: 250px; }
        .drops-add-section { background: var(--bg-card); border: 1px solid var(--border); border-radius: 6px; padding: 1.5rem; }
        .drops-add-section h3 { font-size: 0.9rem; color: var(--text-muted); margin-bottom: 1rem; text-transform: uppercase; letter-spacing: 0.05em; }
        .drops-add-form { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; margin-bottom: 1rem; }
        .drops-add-input { padding: 0.75rem 1rem; background: var(--bg-dark); border: 1px solid var(--border); border-radius: 4px; color: var(--text-primary); font-size: 0.9rem; }
        .drops-add-input:focus { outline: none; border-color: var(--accent-gold); }
        .drops-add-btn { padding: 0.75rem 1.5rem; background: var(--accent-gold); color: var(--bg-dark); border: none; border-radius: 4px; cursor: pointer; font-weight: 500; }
        .drops-add-btn:hover { background: #e5b95c; }
        .drops-yaml-output { margin-top: 1rem; }
        .drops-yaml-output textarea { width: 100%; height: 120px; padding: 1rem; background: var(--bg-dark); border: 1px solid var(--border); border-radius: 4px; color: var(--text-primary); font-family: 'Fira Code', monospace; font-size: 0.8rem; resize: vertical; }
        .drops-yaml-output .copy-btn { margin-top: 0.5rem; padding: 0.5rem 1rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 4px; color: var(--text-secondary); cursor: pointer; font-size: 0.85rem; }
        .drops-yaml-output .copy-btn:hover { background: var(--bg-card-hover); color: var(--text-primary); }
        .drops-count { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 0.5rem; }
        /* Luck Summary Table */
        .luck-table-container { background: var(--bg-card); border: 1px solid var(--border); border-radius: 6px; padding: 1rem; margin-bottom: 2rem; }
        .luck-table-container h3 { font-size: 0.9rem; color: var(--text-muted); margin-bottom: 1rem; text-transform: uppercase; letter-spacing: 0.05em; }
        .luck-table { width: 100%; border-collapse: collapse; }
        .luck-table th { text-align: left; padding: 0.5rem 0.75rem; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-muted); border-bottom: 1px solid var(--border); }
        .luck-table td { padding: 0.5rem 0.75rem; border-bottom: 1px solid var(--border); font-size: 0.8rem; }
        .luck-table tr:last-child td { border-bottom: none; }
        .luck-table tr:hover { background: var(--bg-card-hover); }
        .luck-table .rank-col { color: var(--text-muted); font-family: 'Fira Code', monospace; width: 40px; }
        .luck-table .activity-col { color: var(--text-secondary); }
        .luck-table .drop-col { color: var(--text-primary); }
        .luck-table .kc-col { font-family: 'Fira Code', monospace; color: var(--text-muted); text-align: right; }
        .luck-table .rate-col { font-family: 'Fira Code', monospace; color: var(--text-muted); text-align: right; font-size: 0.75rem; }
        .luck-table .luck-col { font-family: 'Fira Code', monospace; text-align: right; font-weight: 500; }
        .luck-table .status-col { font-size: 0.75rem; font-weight: 500; }
        .luck-very-spooned { color: #22c55e; }
        .luck-spooned { color: #84cc16; }
        .luck-onrate { color: var(--text-secondary); }
        .luck-dry { color: #f97316; }
        .luck-very-dry { color: #ef4444; }
        .luck-pending { color: var(--text-muted); }
        .status-spooned { color: #22c55e; }
        .status-onrate { color: var(--text-secondary); }
        .status-dry { color: #ef4444; }
        .status-pending { color: var(--text-muted); font-style: italic; }
        /* Progression Tab */
        .progression-header { text-align: center; margin-bottom: 2rem; }
        .progression-header h2 { color: var(--accent-gold); margin-bottom: 0.5rem; }
        .progression-header p { color: var(--text-muted); font-size: 0.9rem; }
        .progression-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
        .prog-stat { background: var(--bg-card); border: 1px solid var(--border); border-radius: 6px; padding: 1rem; text-align: center; }
        .prog-stat-value { font-family: 'Fira Code', monospace; font-size: 1.5rem; color: var(--accent-gold); }
        .prog-stat-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--text-muted); margin-top: 0.25rem; }
        .progression-phases { display: flex; flex-direction: column; gap: 2rem; }
        .phase { background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; overflow: hidden; }
        .phase-header { display: flex; justify-content: space-between; align-items: center; padding: 1rem 1.5rem; border-bottom: 1px solid var(--border); }
        .phase-title { display: flex; align-items: center; gap: 0.75rem; }
        .phase-icon { font-size: 1.5rem; }
        .phase-name { font-size: 1.1rem; font-weight: 600; }
        .phase-name span { font-weight: 400; color: var(--text-muted); font-size: 0.85rem; margin-left: 0.5rem; }
        .phase-progress { display: flex; align-items: center; gap: 0.75rem; }
        .phase-progress-bar { width: 120px; height: 8px; background: var(--bg-dark); border-radius: 4px; overflow: hidden; }
        .phase-progress-fill { height: 100%; border-radius: 4px; transition: width 0.3s; }
        .phase-progress-text { font-family: 'Fira Code', monospace; font-size: 0.85rem; color: var(--text-secondary); min-width: 45px; }
        .phase.early .phase-header { background: linear-gradient(90deg, rgba(34, 197, 94, 0.1), transparent); }
        .phase.early .phase-progress-fill { background: #22c55e; }
        .phase.mid .phase-header { background: linear-gradient(90deg, rgba(59, 130, 246, 0.1), transparent); }
        .phase.mid .phase-progress-fill { background: #3b82f6; }
        .phase.late .phase-header { background: linear-gradient(90deg, rgba(168, 85, 247, 0.1), transparent); }
        .phase.late .phase-progress-fill { background: #a855f7; }
        .phase.end .phase-header { background: linear-gradient(90deg, rgba(212, 168, 75, 0.1), transparent); }
        .phase.end .phase-progress-fill { background: var(--accent-gold); }
        .phase-content { padding: 1rem 1.5rem; }
        .milestone-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 0.75rem; }
        .milestone { display: flex; align-items: center; gap: 0.75rem; padding: 0.6rem 0.75rem; background: var(--bg-dark); border-radius: 4px; border-left: 3px solid var(--border); }
        .milestone.complete { border-left-color: #22c55e; }
        .milestone.complete .milestone-icon { color: #22c55e; }
        .milestone.incomplete { opacity: 0.5; }
        .milestone.incomplete .milestone-icon { color: var(--text-muted); }
        .milestone-icon { font-size: 1rem; width: 20px; text-align: center; }
        .milestone-info { flex: 1; min-width: 0; }
        .milestone-name { font-size: 0.85rem; color: var(--text-primary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .milestone-detail { font-size: 0.7rem; color: var(--text-muted); }
        .milestone-status { font-family: 'Fira Code', monospace; font-size: 0.75rem; color: var(--text-muted); }
        .milestone-status.done { color: #22c55e; }
        /* Password Modal */
        .password-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; align-items: center; justify-content: center; }
        .password-modal.active { display: flex; }
        .password-modal-content { background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; padding: 2rem; max-width: 400px; width: 90%; text-align: center; }
        .password-modal-content h3 { color: var(--accent-gold); margin-bottom: 0.5rem; }
        .password-modal-content p { color: var(--text-secondary); margin-bottom: 1.5rem; font-size: 0.9rem; }
        .password-input { width: 100%; padding: 0.75rem 1rem; background: var(--bg-dark); border: 1px solid var(--border); border-radius: 4px; color: var(--text-primary); font-size: 1rem; margin-bottom: 1rem; }
        .password-input:focus { outline: none; border-color: var(--accent-gold); }
        .password-modal-buttons { display: flex; gap: 0.75rem; justify-content: center; }
        .password-btn { padding: 0.75rem 1.5rem; border: 1px solid var(--border); border-radius: 4px; background: var(--bg-card); color: var(--text-secondary); cursor: pointer; font-size: 0.9rem; transition: all 0.2s; }
        .password-btn:hover { background: var(--bg-card-hover); color: var(--text-primary); }
        .password-btn.primary { background: var(--accent-gold); color: var(--bg-dark); border-color: var(--accent-gold); }
        .password-btn.primary:hover { background: #e5b95c; }
        .password-error { color: var(--accent-red); font-size: 0.85rem; margin-top: 1rem; min-height: 1.2em; }
        .protected-tab.locked #bankContainer { filter: blur(10px); pointer-events: none; }
        footer { text-align: center; padding: 2rem 0; margin-top: 3rem; border-top: 1px solid var(--border); }
        footer a { color: var(--text-secondary); text-decoration: none; margin: 0 0.75rem; font-size: 0.85rem; padding: 0.5rem 1rem; border: 1px solid var(--border); border-radius: 4px; transition: all 0.2s; }
        footer a:hover { color: var(--text-primary); border-color: var(--text-muted); }
        @media (max-width: 1050px) {
            .stats-overview { grid-template-columns: repeat(4, 1fr); gap: 0.75rem; }
        }
        @media (max-width: 768px) {
            .stats-overview { grid-template-columns: repeat(3, 1fr); gap: 0.5rem; max-width: 100%; }
            .stat-card { padding: 0.75rem; min-width: auto; }
            .stat-label { font-size: 0.6rem; }
            .stat-value { font-size: 1.1rem; }
            .skills-grid { grid-template-columns: repeat(2, 1fr); }
            .container { padding: 1rem; }
            .player-name { font-size: 2rem; }
            .search-filter { flex-direction: column; }
            .item-list { grid-template-columns: 1fr; }
        }
        @media (max-width: 480px) {
            .stats-overview { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1 class="player-name" id="playerName">FoolinSlays</h1>
            <div class="account-type">
                <img src="https://oldschool.runescape.wiki/images/Ironman_chat_badge.png" alt="Ironman" class="iron-icon">
                Ironman
            </div>
            <div class="last-updated">Last updated: <span id="lastUpdated">—</span></div>
        </header>

        <div class="stats-overview">
            <div class="stat-card" data-tab="skills"><div class="stat-label">Total Level</div><div class="stat-value gold" id="totalLevel">—</div></div>
            <div class="stat-card" data-tab="skills"><div class="stat-label">Total XP</div><div class="stat-value" id="totalXp">—</div></div>
            <div class="stat-card" data-tab="skills"><div class="stat-label">Combat Level</div><div class="stat-value blue" id="combatLevel">—</div></div>
            <div class="stat-card" data-tab="skills"><div class="stat-label">99s</div><div class="stat-value green" id="count99s">—</div></div>
            <div class="stat-card" data-tab="clog"><div class="stat-label">Collection Log</div><div class="stat-value green" id="clogCount">—</div></div>
            <div class="stat-card" data-tab="ca"><div class="stat-label">CA Tasks</div><div class="stat-value" id="caTasks">—</div></div>
            <div class="stat-card" data-tab="pets"><div class="stat-label">Pets</div><div class="stat-value purple" id="petCount">—</div></div>
            <div class="stat-card" data-tab="clues"><div class="stat-label">Clues</div><div class="stat-value" id="clueCount">—</div></div>
            <div class="stat-card" data-tab="bosses"><div class="stat-label">Boss KC</div><div class="stat-value" id="bossKcCard">—</div></div>
            <div class="stat-card" data-tab="quests"><div class="stat-label">Quests</div><div class="stat-value green" id="questCount">—</div></div>
            <div class="stat-card" data-tab="diaries"><div class="stat-label">Diaries</div><div class="stat-value" id="diaryCount">—</div></div>
            <div class="stat-card" data-tab="bank"><div class="stat-label">Bank Value</div><div class="stat-value gold" id="bankValueCard">—</div></div>
        </div>

        <nav class="nav-tabs">
            <button class="nav-tab active" data-tab="skills">Skills</button>
            <button class="nav-tab" data-tab="bosses">Bosses</button>
            <button class="nav-tab" data-tab="clues">Clues</button>
            <button class="nav-tab" data-tab="clog">Collection Log</button>
            <button class="nav-tab" data-tab="ca">Combat Achievements</button>
            <button class="nav-tab" data-tab="pets">Pets</button>
            <button class="nav-tab" data-tab="quests">Quests</button>
            <button class="nav-tab" data-tab="diaries">Diaries</button>
            <button class="nav-tab" data-tab="boaty">B0aty Guide</button>
            <button class="nav-tab" data-tab="goals">Goals</button>
            <button class="nav-tab" data-tab="drops">Drops</button>
            <button class="nav-tab" data-tab="progression">Progression</button>
            <button class="nav-tab" data-tab="bank">Bank</button>
        </nav>

        <div id="skills" class="tab-content active">
            <div class="skills-grid" id="skillsGrid">Loading...</div>
        </div>

        <div id="bosses" class="tab-content">
            <div class="boss-bar-chart" id="bossBarChart"></div>
            <h3 style="font-size: 0.9rem; color: var(--text-muted); margin-bottom: 1rem; text-transform: uppercase; letter-spacing: 0.05em;">📋 All Bosses</h3>
            <div class="boss-grid" id="bossGrid">Loading...</div>
        </div>

        <div id="clues" class="tab-content">
            <div class="clues-grid" id="cluesGrid">Loading...</div>
        </div>

        <div id="clog" class="tab-content">
            <div id="clogContainer">Loading...</div>
        </div>

        <div id="ca" class="tab-content">
            <div id="caContainer">Loading...</div>
        </div>

        <div id="pets" class="tab-content">
            <div id="petsContainer">Loading...</div>
        </div>

        <div id="quests" class="tab-content">
            <div id="questsContainer">Loading...</div>
        </div>

        <div id="diaries" class="tab-content">
            <div id="diariesContainer">Loading...</div>
        </div>

        <div id="boaty" class="tab-content">
            <div id="boatyContainer">Loading...</div>
        </div>

        <div id="goals" class="tab-content">
            <div id="goalsContainer">Loading...</div>
        </div>

        <div id="drops" class="tab-content">
            <div id="dropsContainer">Loading...</div>
        </div>

        <div id="progression" class="tab-content">
            <div id="progressionContainer">Loading...</div>
        </div>

        <div id="bank" class="tab-content protected-tab">
            <div id="bankContainer">Loading...</div>
        </div>

        <!-- Password Modal -->
        <div id="passwordModal" class="password-modal">
            <div class="password-modal-content">
                <h3>🔒 Protected Content</h3>
                <p>Enter password to view bank contents</p>
                <input type="password" id="bankPassword" class="password-input" placeholder="Password" autocomplete="off">
                <div class="password-modal-buttons">
                    <button id="passwordSubmit" class="password-btn primary">Unlock</button>
                    <button id="passwordCancel" class="password-btn">Cancel</button>
                </div>
                <p id="passwordError" class="password-error"></p>
            </div>
        </div>

        <footer>
            <a href="./editor.html">📝 Edit Progress</a>
            <a href="https://templeosrs.com/player/overview.php?player=FoolinSlays" target="_blank">TempleOSRS</a>
            <a href="https://secure.runescape.com/m=hiscore_oldschool_ironman/hiscorepersonal?user1=FoolinSlays" target="_blank">Official Hiscores</a>
            <a href="https://github.com/foolish127/osrs-ironman-progession-tracker" target="_blank">📖 GitHub</a>
        </footer>
    </div>

    <script>
        // Password protection for bank tab
        // Password hash loaded from config file (injected by GitHub Actions)
        let BANK_PASSWORD_HASH = null;
        const PROTECTED_TAB_ID = 'bank';
        let bankUnlocked = false;

        // Load password hash from config
        fetch('./data/config.json')
            .then(r => r.json())
            .then(config => {
                BANK_PASSWORD_HASH = config.bankPasswordHash;
            })
            .catch(() => {
                console.warn('Config not found - bank protection disabled');
            });

        const SKILL_ORDER = ['Attack','Hitpoints','Mining','Strength','Agility','Smithing','Defence','Herblore','Fishing','Ranged','Thieving','Cooking','Prayer','Crafting','Firemaking','Magic','Fletching','Woodcutting','Runecraft','Slayer','Farming','Construction','Hunter','Sailing'];
        const SKILL_ICONS = {};
        SKILL_ORDER.forEach(s => SKILL_ICONS[s] = `https://oldschool.runescape.wiki/images/${s}_icon.png`);

        function formatNumber(n) {
            if (n >= 1e9) return (n/1e9).toFixed(1) + 'B';
            if (n >= 1e6) return (n/1e6).toFixed(1) + 'M';
            if (n >= 1e3) return (n/1e3).toFixed(1) + 'K';
            return n.toLocaleString();
        }

        function formatDate(iso) {
            if (!iso) return '—';
            const d = new Date(iso);
            return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric', hour: '2-digit', minute: '2-digit' });
        }

        function formatShortDate(dateStr) {
            if (!dateStr) return '';
            const d = new Date(dateStr);
            return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }

        let clogData = null;
        let caData = null;
        let petsData = null;
        let cluesData = null;
        let questsData = null;
        let diariesData = null;
        let skillsData = null;
        let bossesData = null;
        let boatyGuide = null;
        let boatyCompleted = new Set();
        let boatySearchTerm = '';
        let boatyFilter = 'all';
        let boatyEpisodeFilter = 'all';

        // Parse collection_log.yaml into the expected JSON structure
        function parseCollectionLogYaml(yamlText) {
            try {
                const data = jsyaml.load(yamlText);
                const collections = {};
                let totalObtained = 0;
                let totalItems = 0;
                const recentItems = [];

                for (const [category, content] of Object.entries(data)) {
                    if (!content || typeof content !== 'object') continue;

                    const obtainedRaw = content.obtained || [];
                    const missingRaw = content.missing || [];

                    // Parse obtained items
                    const obtained = obtainedRaw.map(item => {
                        if (typeof item === 'string' && item.includes('|')) {
                            const [name, date] = item.split('|').map(s => s.trim());
                            if (date) {
                                recentItems.push({ name, date, collection: category });
                                return { name, date };
                            }
                            return { name };
                        }
                        return { name: String(item).trim() };
                    });

                    // Parse missing items
                    const missing = missingRaw.map(item => String(item).trim());

                    const obtainedCount = obtained.length;
                    const missingCount = missing.length;

                    collections[category] = {
                        obtained,
                        missing,
                        obtained_count: obtainedCount,
                        total_count: obtainedCount + missingCount
                    };

                    totalObtained += obtainedCount;
                    totalItems += obtainedCount + missingCount;
                }

                // Sort recent items by date (newest first)
                recentItems.sort((a, b) => (b.date || '').localeCompare(a.date || ''));

                return {
                    collection_log: {
                        total_obtained: totalObtained,
                        total_items: totalItems,
                        recent_items: recentItems.slice(0, 20),
                        collections
                    }
                };
            } catch (e) {
                console.error('Failed to parse collection_log.yaml:', e);
                return null;
            }
        }

        // TempleOSRS API integration
        const TEMPLE_PLAYER = 'Foolinslays';
        let templeItemsMap = null;
        let templeCategoriesMap = null;

        async function loadTempleMetadata() {
            try {
                const [itemsRes, catsRes] = await Promise.all([
                    fetch('https://templeosrs.com/api/collection-log/items.php').then(r => r.json()).catch(() => null),
                    fetch('https://templeosrs.com/api/collection-log/categories.php').then(r => r.json()).catch(() => null)
                ]);
                templeItemsMap = itemsRes?.data || null;
                templeCategoriesMap = catsRes?.data || null;
                return templeItemsMap && templeCategoriesMap;
            } catch (e) {
                console.log('TempleOSRS metadata failed:', e);
                return false;
            }
        }

        async function loadTempleCollectionLog() {
            try {
                // First load metadata maps
                const metaLoaded = await loadTempleMetadata();
                if (!metaLoaded) return null;

                // Fetch player data and recent items
                const [playerRes, recentRes] = await Promise.all([
                    fetch(`https://templeosrs.com/api/collection-log/player_collection_log.php?player=${TEMPLE_PLAYER}&categories=all`).then(r => r.json()).catch(() => null),
                    fetch(`https://templeosrs.com/api/collection-log/player_recent_items.php?player=${TEMPLE_PLAYER}`).then(r => r.json()).catch(() => null)
                ]);

                if (!playerRes?.data) return null;

                const collections = {};
                let totalObtained = 0;
                let totalItems = 0;

                // Build collections from Temple data
                for (const [catKey, catData] of Object.entries(templeCategoriesMap)) {
                    const catName = catData.name || catKey;
                    const catItemIds = catData.items || [];
                    const playerCatData = playerRes.data[catKey];
                    const obtainedIds = playerCatData?.items ? Object.keys(playerCatData.items).map(Number) : [];

                    const obtained = [];
                    const missing = [];

                    for (const itemId of catItemIds) {
                        const itemName = templeItemsMap[itemId]?.name || `Item ${itemId}`;
                        if (obtainedIds.includes(itemId)) {
                            const itemData = playerCatData.items[itemId];
                            obtained.push({
                                name: itemName,
                                date: itemData?.date || null,
                                quantity: itemData?.quantity || 1
                            });
                        } else {
                            missing.push(itemName);
                        }
                    }

                    if (catItemIds.length > 0) {
                        collections[catName] = {
                            obtained,
                            missing,
                            obtained_count: obtained.length,
                            total_count: catItemIds.length
                        };
                        totalObtained += obtained.length;
                        totalItems += catItemIds.length;
                    }
                }

                // Build recent items from recentRes
                const recentItems = [];
                if (recentRes?.data) {
                    for (const item of recentRes.data.slice(0, 20)) {
                        recentItems.push({
                            name: templeItemsMap[item.item_id]?.name || `Item ${item.item_id}`,
                            date: item.date,
                            collection: templeCategoriesMap[item.category]?.name || item.category
                        });
                    }
                }

                console.log(`Loaded from TempleOSRS: ${totalObtained}/${totalItems} items`);

                return {
                    collection_log: {
                        total_obtained: totalObtained,
                        total_items: totalItems,
                        recent_items: recentItems,
                        collections,
                        source: 'templeosrs'
                    }
                };
            } catch (e) {
                console.log('TempleOSRS API failed:', e);
                return null;
            }
        }

        async function loadData() {
            const [skillsRes, bossesRes, cluesRes, clogRes, caRes, petsRes, questsRes, goalsRes, diariesRes, bankRes, dropsRes, boatyGuideRes, boatyProgressRes, potionStorageRes, seedVaultRes] = await Promise.all([
                fetch('./data/skills.json').then(r=>r.json()).catch(()=>null),
                fetch('./data/bosses.json').then(r=>r.json()).catch(()=>null),
                fetch('./data/clues.json').then(r=>r.json()).catch(()=>null),
                fetch('./data/collection_log.json').then(r=>r.json()).catch(()=>null),
                fetch('./data/combat_achievements.json').then(r=>r.json()).catch(()=>null),
                fetch('./data/pets.json').then(r=>r.json()).catch(()=>null),
                fetch('./data/quests.json').then(r=>r.json()).catch(()=>null),
                fetch('./data/goals.yaml').then(r=>r.text()).catch(()=>null),
                fetch('./data/diaries.yaml').then(r=>r.text()).catch(()=>null),
                fetch('./data/bank.json').then(r=>r.json()).catch(()=>null),
                fetch('./data/drops.yaml').then(r=>r.text()).catch(()=>null),
                fetch('./data/boaty_guide.json').then(r=>r.json()).catch(()=>null),
                fetch('./data/boaty_progress.yaml').then(r=>r.text()).catch(()=>null),
                fetch('./data/potion_storage.json').then(r=>r.json()).catch(()=>null),
                fetch('./data/seed_vault.json').then(r=>r.json()).catch(()=>null)
            ]);

            if (skillsRes?.rsn) {
                document.getElementById('playerName').textContent = skillsRes.rsn;
                document.getElementById('lastUpdated').textContent = formatDate(skillsRes.updated);
            }

            if (skillsRes?.milestones) {
                const m = skillsRes.milestones;
                document.getElementById('totalLevel').textContent = m.total_level?.toLocaleString() || '—';
                document.getElementById('totalXp').textContent = formatNumber(m.total_xp || 0);
                document.getElementById('combatLevel').textContent = m.combat_level || '—';
                document.getElementById('count99s').textContent = `${m.skills_99||0}/${m.num_skills||24}`;
            }

            if (clogRes?.collection_log) {
                clogData = clogRes.collection_log;
                clogData.rsn = clogRes.rsn || 'FoolinSlays';
                document.getElementById('clogCount').textContent = `${clogData.total_obtained}/${clogData.total_items}`;
            }

            // Try TempleOSRS API (will override YAML data if successful)
            try {
                const templeData = await loadTempleCollectionLog();
                if (templeData?.collection_log) {
                    clogData = templeData.collection_log;
                    clogData.rsn = templeData.rsn || clogData.rsn || 'FoolinSlays';
                    document.getElementById('clogCount').textContent = `${clogData.total_obtained}/${clogData.total_items}`;
                    console.log('Using TempleOSRS data');
                }
            } catch (e) {
                console.log('TempleOSRS failed, using YAML fallback');
            }

            if (caRes?.combat_achievements) {
                caData = caRes.combat_achievements;
                document.getElementById('caTasks').textContent = `${caData.total_completed}/${caData.total_tasks}`;
            }

            if (petsRes?.pets) {
                petsData = petsRes.pets;
                document.getElementById('petCount').textContent = `${petsData.total_obtained}/${petsData.total_pets}`;
            }

            if (cluesRes?.clues) {
                cluesData = cluesRes.clues;
                const allClues = cluesData['Clue Scrolls (all)'];
                const totalClues = allClues ? allClues.count : 0;
                document.getElementById('clueCount').textContent = totalClues.toLocaleString();
            }

            if (questsRes?.quests) {
                questsData = questsRes.quests;
                document.getElementById('questCount').textContent = `${questsData.total_completed}/${questsData.total_quests}`;
            }

            if (skillsRes?.skills) {
                skillsData = skillsRes.skills;
                renderSkills(skillsRes.skills);
            }
            if (bossesRes?.bosses) {
                bossesData = bossesRes.bosses;
                renderBosses(bossesRes.bosses);
            }
            renderClues();
            renderCollectionLog();
            renderCombatAchievements();
            renderPets();
            renderQuests();
            if (diariesRes) renderDiaries(diariesRes);
            if (boatyGuideRes) {
                boatyGuide = boatyGuideRes;
                if (boatyProgressRes) parseBoatyProgress(boatyProgressRes);
                renderBoatyGuide();
            }
            if (goalsRes) renderGoals(goalsRes);
            if (dropsRes) renderDrops(dropsRes);
            renderProgression(dropsRes);
            if (bankRes) renderBank(bankRes, potionStorageRes, seedVaultRes);
        }

        function renderSkills(skills) {
            const grid = document.getElementById('skillsGrid');
            grid.innerHTML = SKILL_ORDER.map(name => {
                const s = skills[name] || { level: 1, xp: 0 };
                const isMaxed = s.level >= 99;
                const prog = s.progress?.progress || 0;
                const progClass = prog < 33 ? 'low' : prog < 66 ? 'mid' : 'high';
                return `<div class="skill-item ${isMaxed ? 'maxed' : ''}">
                    <img src="${SKILL_ICONS[name]}" alt="${name}" class="skill-icon">
                    <div class="skill-info">
                        <div class="skill-name">${name}</div>
                        <div class="skill-level ${isMaxed ? 'maxed' : ''}">${s.level}</div>
                        <div class="skill-xp">${formatNumber(s.xp)} XP</div>
                        ${!isMaxed ? `<div class="skill-progress"><div class="skill-progress-fill ${progClass}" style="width:${prog}%"></div></div>` : ''}
                    </div>
                </div>`;
            }).join('');
        }

        function renderBosses(bosses) {
            const sorted = Object.entries(bosses).filter(([_,d])=>d.kc>0).sort((a,b)=>b[1].kc-a[1].kc);
            
            // Calculate total KC for stat card
            const totalKc = sorted.reduce((sum, [_, d]) => sum + d.kc, 0);
            const formatKc = (kc) => {
                if (kc >= 1000000) return (kc / 1000000).toFixed(1) + 'M';
                if (kc >= 1000) return (kc / 1000).toFixed(1) + 'K';
                return kc.toLocaleString();
            };
            document.getElementById('bossKcCard').textContent = formatKc(totalKc);
            
            // Render bar chart (top 15 bosses)
            const maxKc = sorted.length > 0 ? sorted[0][1].kc : 1;
            const top15 = sorted.slice(0, 15);
            const barChartContainer = document.getElementById('bossBarChart');
            barChartContainer.innerHTML = `
                <h3>📊 Top Kill Counts</h3>
                ${top15.map(([name, data]) => {
                    const percentage = (data.kc / maxKc) * 100;
                    return `
                        <div class="boss-bar">
                            <span class="boss-bar-name" title="${name}">${name}</span>
                            <div class="boss-bar-track">
                                <div class="boss-bar-fill" style="width: ${percentage}%"></div>
                            </div>
                            <span class="boss-bar-kc">${data.kc.toLocaleString()}</span>
                        </div>
                    `;
                }).join('')}
            `;
            
            document.getElementById('bossGrid').innerHTML = sorted.map(([n,d])=>
                `<div class="boss-item"><span class="boss-name">${n}</span><span class="boss-kc">${d.kc.toLocaleString()} KC</span></div>`
            ).join('');
        }

        function renderClues() {
            const grid = document.getElementById('cluesGrid');
            if (!cluesData) {
                grid.innerHTML = '<div class="empty-state">Clue scroll data not available</div>';
                return;
            }
            
            const order = ['Clue Scrolls (all)', 'Clue Scrolls (beginner)', 'Clue Scrolls (easy)', 
                          'Clue Scrolls (medium)', 'Clue Scrolls (hard)', 'Clue Scrolls (elite)', 'Clue Scrolls (master)'];
            
            const getTier = name => {
                if (name.includes('beginner')) return 'beginner';
                if (name.includes('easy')) return 'easy';
                if (name.includes('medium')) return 'medium';
                if (name.includes('hard')) return 'hard';
                if (name.includes('elite')) return 'elite';
                if (name.includes('master')) return 'master';
                return 'all';
            };
            
            const sorted = Object.entries(cluesData).sort((a, b) => {
                const aIdx = order.indexOf(a[0]);
                const bIdx = order.indexOf(b[0]);
                if (aIdx >= 0 && bIdx >= 0) return aIdx - bIdx;
                if (aIdx >= 0) return -1;
                if (bIdx >= 0) return 1;
                return b[1].count - a[1].count;
            });
            
            grid.innerHTML = sorted.map(([name, data]) => {
                const tier = getTier(name);
                const displayName = name.replace('Clue Scrolls ', '').replace('(', '').replace(')', '');
                return `<div class="clue-item ${tier}">
                    <span class="clue-name">${displayName}</span>
                    <span class="clue-count">${data.count.toLocaleString()}</span>
                </div>`;
            }).join('');
        }

        function renderCollectionLog(searchTerm = '', statusFilter = 'all') {
            const container = document.getElementById('clogContainer');
            if (!clogData) {
                container.innerHTML = '<div class="empty-state">Collection log data not available</div>';
                return;
            }

            // Define category mappings (matching in-game categories)
            const categoryMappings = {
                'Bosses': [
                    'Abyssal Sire', 'Alchemical Hydra', 'Araxxor', 'Barrows', 'Bryophyta',
                    'Callisto', 'Cerberus', 'Chaos Elemental', 'Chaos Fanatic', 'Commander Zilyana',
                    'Corporeal Beast', 'Crazy Archaeologist', 'Dagannoth', 'Duke Sucellus',
                    'General Graardor', 'Giant Mole', 'Grotesque Guardians', 'Hespori', 'Kalphite Queen',
                    'King Black Dragon', 'Kraken', 'Kree', 'K\'ril', 'Lunar Chests',
                    'Nex', 'Nightmare', 'Obor', 'Phantom Muspah', 'Sarachnis', 'Scorpia', 'Scurrius',
                    'Skotizo', 'Sol Heredit', 'Spindel', 'Hueycoatl', 'Leviathan', 'Whisperer',
                    'Thermonuclear', 'Smoke Devil', 'Vardorvis', 'Venenatis', 'Vet\'ion', 'Vorkath',
                    'Zulrah', 'Amoxliatl', 'Artio', 'Calvar', 'Tormented Demons', 'Perilous Moons', 'Yama',
                    'Gauntlet', 'Inferno', 'Fight Caves', 'Colosseum', 'Fortis'
                ],
                'Raids': [
                    'Chambers of Xeric', 'Theatre of Blood', 'Tombs of Amascut'
                ],
                'Clues': [
                    'Treasure Trails', 'Beginner Clue', 'Easy Clue', 'Medium Clue',
                    'Hard Clue', 'Elite Clue', 'Master Clue', 'Shared Clue', 'Shared Treasure'
                ],
                'Minigames': [
                    'Barbarian Assault', 'Brimhaven Agility', 'Castle Wars', 'Fishing Trawler',
                    'Gnome Restaurant', 'Guardians of the Rift', 'Hallowed Sepulchre', 'Last Man Standing',
                    'Magic Training Arena', 'Mahogany Homes', 'Pest Control', 'Rogues',
                    'Shades of Mort', 'Soul Wars', 'Tempoross', 'Tithe Farm', 'Trouble Brewing',
                    'Volcanic Mine', 'Wintertodt', 'Giants\' Foundry', 'Zalcano', 'Mage Arena'
                ],
                'Other': [] // Everything else goes here
            };

            // Calculate category totals
            function getCategoryStats() {
                const stats = {
                    'Bosses': { obtained: 0, total: 0, icon: '⚔️' },
                    'Raids': { obtained: 0, total: 0, icon: '🏛️' },
                    'Clues': { obtained: 0, total: 0, icon: '📜' },
                    'Minigames': { obtained: 0, total: 0, icon: '🎮' },
                    'Other': { obtained: 0, total: 0, icon: '📦' }
                };

                for (const [collName, coll] of Object.entries(clogData.collections)) {
                    let matched = false;
                    const collNameLower = collName.toLowerCase();
                    
                    // Check each category (except Other which is the default)
                    for (const [catName, patterns] of Object.entries(categoryMappings)) {
                        if (catName === 'Other') continue; // Skip Other, it's the default
                        
                        // Check if collection name contains any pattern
                        const matchesPattern = patterns.some(p => collNameLower.includes(p.toLowerCase()));
                        if (matchesPattern) {
                            stats[catName].obtained += coll.obtained_count || 0;
                            stats[catName].total += coll.total_count || 0;
                            matched = true;
                            break;
                        }
                    }
                    // Default to Other if no match
                    if (!matched) {
                        stats['Other'].obtained += coll.obtained_count || 0;
                        stats['Other'].total += coll.total_count || 0;
                    }
                }
                return stats;
            }

            const categoryStats = getCategoryStats();
            const pct = ((clogData.total_obtained / clogData.total_items) * 100).toFixed(1);
            
            // Helper to get wiki image URL
            function getItemImageUrl(itemName) {
                // Use wiki's standard image naming convention
                const formatted = encodeURIComponent(itemName.replace(/ /g, '_'));
                return `https://oldschool.runescape.wiki/images/${formatted}.png`;
            }
            
            // Build overview HTML
            let html = `
                <div class="clog-overview">
                    <div class="clog-overview-title">Collection Log – Overview for ${clogData.rsn || 'FoolinSlays'}</div>
                    <div class="clog-categories">
                        ${Object.entries(categoryStats).map(([name, stats]) => {
                            const catPct = stats.total > 0 ? (stats.obtained / stats.total * 100) : 0;
                            return `
                            <div class="clog-category">
                                <div class="clog-category-icon">${stats.icon}</div>
                                <div class="clog-category-name">${name}</div>
                                <div class="clog-category-count"><span class="obtained">${stats.obtained}</span>/${stats.total}</div>
                                <div class="clog-category-bar"><div class="clog-category-bar-fill" style="width:${catPct}%"></div></div>
                            </div>`;
                        }).join('')}
                    </div>
                    <div class="clog-total">
                        <div class="clog-total-bar">
                            <div class="clog-total-bar-fill" style="width:${pct}%"></div>
                            <div class="clog-total-text">Collections Logged: ${clogData.total_obtained}/${clogData.total_items}</div>
                        </div>
                    </div>
                    ${clogData.recent_items?.length > 0 ? `
                    <div class="clog-latest">
                        <div class="clog-latest-title">Latest Collections</div>
                        <div class="clog-latest-items">
                            ${clogData.recent_items.slice(0, 10).map(item => {
                                const safeChar = item.name.charAt(0).replace(/'/g, '');
                                return `
                                <div class="clog-latest-item" title="${item.name.replace(/"/g, '&quot;')} - ${(item.collection || '').replace(/"/g, '&quot;')}">
                                    <img src="${getItemImageUrl(item.name)}" alt="${item.name.replace(/"/g, '&quot;')}" onerror="this.style.display='none'; this.parentElement.innerHTML='${safeChar}';">
                                </div>`;
                            }).join('')}
                        </div>
                    </div>` : ''}
                </div>`;

            // Progress section
            html += `
                <div class="progress-section">
                    <div class="progress-header">
                        <span class="progress-title">Collection Log Progress</span>
                        <span class="progress-stats"><span class="obtained">${clogData.total_obtained}</span> <span class="total">/ ${clogData.total_items}</span></span>
                    </div>
                    <div class="progress-bar"><div class="progress-fill" style="width:${pct}%"></div></div>
                    <div class="progress-percentage">${pct}%</div>
                </div>`;
            
            html += `<div class="search-filter">
                    <input type="text" class="search-input" id="clogSearch" placeholder="Search items or collections..." value="${searchTerm}">
                    <select class="filter-select" id="clogFilter">
                        <option value="all" ${statusFilter==='all'?'selected':''}>All Items</option>
                        <option value="obtained" ${statusFilter==='obtained'?'selected':''}>Obtained Only</option>
                        <option value="missing" ${statusFilter==='missing'?'selected':''}>Missing Only</option>
                    </select>
                </div>
                <div id="clogList"></div>`;
            
            container.innerHTML = html;
            
            document.getElementById('clogSearch').addEventListener('input', e => renderClogList(e.target.value, document.getElementById('clogFilter').value));
            document.getElementById('clogFilter').addEventListener('change', e => renderClogList(document.getElementById('clogSearch').value, e.target.value));
            
            renderClogList(searchTerm, statusFilter);
        }

        function renderClogList(searchTerm, statusFilter) {
            const list = document.getElementById('clogList');
            const search = searchTerm.toLowerCase();
            let html = '';

            for (const [collName, coll] of Object.entries(clogData.collections).sort((a,b) => a[0].localeCompare(b[0]))) {
                let obtained = coll.obtained || [];
                let missing = coll.missing || [];
                
                if (search) {
                    if (!collName.toLowerCase().includes(search)) {
                        obtained = obtained.filter(i => (i.name || i).toLowerCase().includes(search));
                        missing = missing.filter(i => (i.name || i).toLowerCase().includes(search));
                    }
                }
                
                let items = [];
                if (statusFilter === 'all' || statusFilter === 'obtained') {
                    items = items.concat(obtained.map(i => ({ name: i.name || i, date: i.date, obtained: true })));
                }
                if (statusFilter === 'all' || statusFilter === 'missing') {
                    items = items.concat(missing.map(i => ({ name: i.name || i, obtained: false })));
                }
                
                if (items.length === 0) continue;
                
                html += `<div class="collection">
                    <div class="collection-header" onclick="this.parentElement.classList.toggle('expanded')">
                        <span class="collection-name">${collName}</span>
                        <span class="collection-count"><span class="obtained">${coll.obtained_count}</span> <span class="total">/ ${coll.total_count}</span></span>
                    </div>
                    <div class="collection-items">
                        <div class="item-list">
                            ${items.map(i => `<div class="item ${i.obtained ? 'obtained' : 'missing'}">
                                <span class="item-check">${i.obtained ? '✓' : '○'}</span>
                                <span class="item-name">${i.name}</span>
                                ${i.date ? `<span class="item-date">${formatShortDate(i.date)}</span>` : ''}
                            </div>`).join('')}
                        </div>
                    </div>
                </div>`;
            }
            
            list.innerHTML = html || '<div class="empty-state">No items match your search</div>';
        }

        function renderCombatAchievements(searchTerm = '', statusFilter = 'all') {
            const container = document.getElementById('caContainer');
            if (!caData) {
                container.innerHTML = '<div class="empty-state">Combat achievements data not available</div>';
                return;
            }

            const pct = ((caData.total_points / caData.max_points) * 100).toFixed(1);
            const tierColors = { Easy: '#3fb950', Medium: '#58a6ff', Hard: '#a371f7', Elite: '#d4a84b', Master: '#f85149', Grandmaster: '#ff7b72' };
            
            // CA tier unlock thresholds (from OSRS Wiki - updated)
            const tierUnlocks = [
                { name: 'Easy', points: 38, rewards: ['Ghommal\'s hilt 1', '5% easy clue boost', '+5 boss task kills'] },
                { name: 'Medium', points: 148, rewards: ['Ghommal\'s hilt 2', '5% medium clue boost', '+10 boss task kills'] },
                { name: 'Hard', points: 394, rewards: ['Ghommal\'s hilt 3', 'Unlimited GWD teles', 'GWD private instances'] },
                { name: 'Elite', points: 1038, rewards: ['Ghommal\'s hilt 4', '5% elite clue boost', 'Cannon holds 60'] },
                { name: 'Master', points: 1878, rewards: ['Ghommal\'s hilt 5', 'Red slayer helmet'] },
                { name: 'Grandmaster', points: 2618, rewards: ['Ghommal\'s hilt 6', 'Green slayer helmet'] }
            ];
            
            // Find current and next tier
            let currentTier = null;
            let nextTier = null;
            for (let i = 0; i < tierUnlocks.length; i++) {
                if (caData.total_points >= tierUnlocks[i].points) {
                    currentTier = tierUnlocks[i];
                } else {
                    nextTier = tierUnlocks[i];
                    break;
                }
            }
            
            let html = `
                <div class="progress-section">
                    <div class="progress-header">
                        <span class="progress-title">Overall Progress</span>
                        <span class="progress-stats"><span class="obtained">${caData.total_points}</span> <span class="total">/ ${caData.max_points} points</span></span>
                    </div>
                    <div class="progress-bar"><div class="progress-fill" style="width:${pct}%"></div></div>
                    <div class="progress-percentage">${pct}% · ${caData.total_completed}/${caData.total_tasks} tasks</div>
                </div>`;
            
            // Tier unlock progress
            if (nextTier) {
                const prevPoints = currentTier ? currentTier.points : 0;
                const pointsInTier = caData.total_points - prevPoints;
                const pointsNeeded = nextTier.points - prevPoints;
                const tierPct = ((pointsInTier / pointsNeeded) * 100).toFixed(1);
                const pointsRemaining = nextTier.points - caData.total_points;
                
                html += `
                <div class="progress-section" style="margin-top: 1rem;">
                    <div class="progress-header">
                        <span class="progress-title">Next Unlock: <span style="color:${tierColors[nextTier.name]}">${nextTier.name} Tier</span></span>
                        <span class="progress-stats"><span class="obtained">${caData.total_points}</span> <span class="total">/ ${nextTier.points} points</span></span>
                    </div>
                    <div class="progress-bar"><div class="progress-fill" style="width:${tierPct}%;background:${tierColors[nextTier.name]}"></div></div>
                    <div class="progress-percentage">${pointsRemaining} points to go</div>
                    <div class="tier-rewards">
                        <span class="rewards-label">Unlocks:</span> ${nextTier.rewards.join(' · ')}
                    </div>
                </div>`;
            } else {
                html += `
                <div class="progress-section" style="margin-top: 1rem; border-color: var(--accent-gold);">
                    <div class="progress-header">
                        <span class="progress-title" style="color: var(--accent-gold);">🏆 Grandmaster Tier Unlocked!</span>
                    </div>
                    <div class="tier-rewards">All Combat Achievement rewards unlocked</div>
                </div>`;
            }
            
            // Tier overview
            html += `
                <div class="tier-overview">
                    <div class="tier-overview-title">Tier Unlocks</div>
                    <div class="tier-overview-grid">
                        ${tierUnlocks.map(tier => {
                            const unlocked = caData.total_points >= tier.points;
                            return `<div class="tier-badge ${unlocked ? 'unlocked' : ''}" style="border-color:${tierColors[tier.name]}">
                                <span class="tier-badge-name" style="color:${unlocked ? tierColors[tier.name] : 'var(--text-muted)'}">${tier.name}</span>
                                <span class="tier-badge-points">${tier.points} pts</span>
                                ${unlocked ? '<span class="tier-badge-check">✓</span>' : ''}
                            </div>`;
                        }).join('')}
                    </div>
                </div>`;
            
            // Recent activity
            if (caData.recent_tasks?.length > 0) {
                html += `<div class="recent-activity">
                    <div class="recent-title">🏆 Recent Completions</div>
                    <div class="recent-list">
                        ${caData.recent_tasks.slice(0, 5).map(task => `
                            <div class="recent-item">
                                <div><span class="recent-item-name">${task.name}</span> <span class="recent-item-source">${task.tier}</span></div>
                                <span class="recent-item-date">${formatShortDate(task.date)}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>`;
            }
            
            html += `<div class="search-filter">
                <input type="text" class="search-input" id="caSearch" placeholder="Search tasks..." value="${searchTerm}">
                <select class="filter-select" id="caFilter">
                    <option value="all" ${statusFilter==='all'?'selected':''}>All Tasks</option>
                    <option value="completed" ${statusFilter==='completed'?'selected':''}>Completed Only</option>
                    <option value="not_completed" ${statusFilter==='not_completed'?'selected':''}>Remaining Only</option>
                </select>
            </div>`;
            
            const search = searchTerm.toLowerCase();
            
            for (const [tierName, tier] of Object.entries(caData.tiers)) {
                let completed = tier.completed || [];
                let notCompleted = tier.not_completed || [];
                
                if (search) {
                    completed = completed.filter(t => (t.name || t).toLowerCase().includes(search));
                    notCompleted = notCompleted.filter(t => (t.name || t).toLowerCase().includes(search));
                }
                
                let tasks = [];
                if (statusFilter === 'all' || statusFilter === 'completed') {
                    tasks = tasks.concat(completed.map(t => ({ name: t.name || t, date: t.date, done: true })));
                }
                if (statusFilter === 'all' || statusFilter === 'not_completed') {
                    tasks = tasks.concat(notCompleted.map(t => ({ name: t.name || t, done: false })));
                }
                
                if (tasks.length === 0 && search) continue;
                
                const tierPct = tier.total_count > 0 ? ((tier.completed_count / tier.total_count) * 100) : 0;
                const color = tierColors[tierName] || '#888';
                
                html += `<div class="ca-tier">
                    <div class="ca-tier-header" onclick="this.parentElement.classList.toggle('expanded')">
                        <span class="ca-tier-name ${tierName.toLowerCase()}">${tierName} (${tier.points_per_task} pt${tier.points_per_task > 1 ? 's' : ''})</span>
                        <div class="ca-tier-stats">
                            <span><span style="color:${color}">${tier.completed_count}</span> / ${tier.total_count}</span>
                            <div class="ca-tier-progress"><div class="ca-tier-progress-fill" style="width:${tierPct}%;background:${color}"></div></div>
                        </div>
                    </div>
                    <div class="ca-tier-tasks">
                        <div class="item-list">
                            ${tasks.map(t => `<div class="item ${t.done ? 'obtained' : 'missing'}">
                                <span class="item-check">${t.done ? '✓' : '○'}</span>
                                <span class="item-name">${t.name}</span>
                                ${t.date ? `<span class="item-date">${formatShortDate(t.date)}</span>` : ''}
                            </div>`).join('')}
                        </div>
                    </div>
                </div>`;
            }
            
            container.innerHTML = html;
            
            document.getElementById('caSearch').addEventListener('input', e => renderCombatAchievements(e.target.value, document.getElementById('caFilter').value));
            document.getElementById('caFilter').addEventListener('change', e => renderCombatAchievements(document.getElementById('caSearch').value, e.target.value));
        }

        function renderPets() {
            const container = document.getElementById('petsContainer');
            if (!petsData) {
                container.innerHTML = '<div class="empty-state">Pets data not available</div>';
                return;
            }

            const pct = ((petsData.total_obtained / petsData.total_pets) * 100).toFixed(1);
            
            let html = `
                <div class="progress-section">
                    <div class="progress-header">
                        <span class="progress-title">🐾 Pet Collection</span>
                        <span class="progress-stats"><span class="obtained">${petsData.total_obtained}</span> <span class="total">/ ${petsData.total_pets}</span></span>
                    </div>
                    <div class="progress-bar"><div class="progress-fill" style="width:${pct}%"></div></div>
                    <div class="progress-percentage">${pct}%</div>
                </div>
                <div class="search-filter">
                    <input type="text" class="search-input" id="petSearch" placeholder="Search pets...">
                    <select class="filter-select" id="petFilter">
                        <option value="all">All Pets</option>
                        <option value="obtained">Obtained Only</option>
                        <option value="missing">Missing Only</option>
                    </select>
                </div>
                <div class="pets-grid" id="petsGrid"></div>`;
            
            container.innerHTML = html;
            
            document.getElementById('petSearch').addEventListener('input', renderPetGrid);
            document.getElementById('petFilter').addEventListener('change', renderPetGrid);
            
            renderPetGrid();
        }

        function renderPetGrid() {
            const grid = document.getElementById('petsGrid');
            const search = document.getElementById('petSearch').value.toLowerCase();
            const filter = document.getElementById('petFilter').value;
            
            let pets = [];
            
            if (filter === 'all' || filter === 'obtained') {
                pets = pets.concat((petsData.obtained || []).map(p => ({
                    name: p.name || p,
                    date: p.date,
                    source: p.source,
                    obtained: true
                })));
            }
            
            if (filter === 'all' || filter === 'missing') {
                pets = pets.concat((petsData.missing || []).map(p => ({
                    name: p.name || p,
                    source: p.source,
                    obtained: false
                })));
            }
            
            if (search) {
                pets = pets.filter(p => 
                    p.name.toLowerCase().includes(search) || 
                    (p.source && p.source.toLowerCase().includes(search))
                );
            }
            
            // Sort: obtained first, then alphabetically
            pets.sort((a, b) => {
                if (a.obtained !== b.obtained) return b.obtained - a.obtained;
                return a.name.localeCompare(b.name);
            });
            
            grid.innerHTML = pets.map(p => `
                <div class="pet-card ${p.obtained ? 'obtained' : 'missing'}">
                    <div class="pet-name">${p.name}</div>
                    ${p.source ? `<div class="pet-source">${p.source}</div>` : ''}
                    ${p.date ? `<div class="pet-date">${formatShortDate(p.date)}</div>` : ''}
                </div>
            `).join('') || '<div class="empty-state">No pets match your search</div>';
        }

        function renderQuests() {
            const container = document.getElementById('questsContainer');
            if (!questsData) {
                container.innerHTML = '<div class="empty-state">Quest data not available</div>';
                return;
            }

            const pct = ((questsData.total_completed / questsData.total_quests) * 100).toFixed(1);
            const qpPct = ((questsData.quest_points / questsData.max_quest_points) * 100).toFixed(1);
            
            let html = `
                <div class="progress-section">
                    <div class="progress-header">
                        <span class="progress-title">📜 Quest Progress</span>
                        <span class="progress-stats"><span class="obtained">${questsData.total_completed}</span> <span class="total">/ ${questsData.total_quests}</span></span>
                    </div>
                    <div class="progress-bar"><div class="progress-fill" style="width:${pct}%"></div></div>
                    <div class="progress-percentage">${pct}%</div>
                </div>
                <div class="progress-section">
                    <div class="progress-header">
                        <span class="progress-title">⭐ Quest Points</span>
                        <span class="progress-stats"><span class="obtained">${questsData.quest_points}</span> <span class="total">/ ${questsData.max_quest_points}</span></span>
                    </div>
                    <div class="progress-bar"><div class="progress-fill" style="width:${qpPct}%"></div></div>
                    <div class="progress-percentage">${qpPct}%</div>
                </div>
                <div class="search-filter">
                    <input type="text" class="search-input" id="questSearch" placeholder="Search quests...">
                    <select class="filter-select" id="questFilter">
                        <option value="all">All Quests</option>
                        <option value="completed">Completed</option>
                        <option value="incomplete">Not Completed</option>
                        <option value="f2p">Free-to-play</option>
                        <option value="members">Members</option>
                        <option value="miniquests">Miniquests</option>
                    </select>
                </div>
                <div id="questsList"></div>`;
            
            container.innerHTML = html;
            
            document.getElementById('questSearch').addEventListener('input', renderQuestList);
            document.getElementById('questFilter').addEventListener('change', renderQuestList);
            
            renderQuestList();
        }

        function renderQuestList() {
            const list = document.getElementById('questsList');
            const search = document.getElementById('questSearch').value.toLowerCase();
            const filter = document.getElementById('questFilter').value;
            
            const categories = ['Free-to-play', 'Members', 'Miniquests'];
            let html = '';
            
            categories.forEach(cat => {
                const catData = questsData.categories[cat];
                if (!catData) return;
                
                // Filter by category
                if (filter === 'f2p' && cat !== 'Free-to-play') return;
                if (filter === 'members' && cat !== 'Members') return;
                if (filter === 'miniquests' && cat !== 'Miniquests') return;
                
                let quests = [];
                
                if (filter === 'all' || filter === 'completed' || filter === 'f2p' || filter === 'members' || filter === 'miniquests') {
                    quests = quests.concat((catData.completed || []).map(q => {
                        const item = typeof q === 'string' ? {name: q} : q;
                        return {...item, completed: true};
                    }));
                }
                if (filter === 'all' || filter === 'incomplete' || filter === 'f2p' || filter === 'members' || filter === 'miniquests') {
                    quests = quests.concat((catData.not_completed || []).map(q => {
                        const item = typeof q === 'string' ? {name: q} : q;
                        return {...item, completed: false};
                    }));
                }
                
                // Filter by search
                if (search) {
                    quests = quests.filter(q => q.name.toLowerCase().includes(search));
                }
                
                if (quests.length === 0) return;
                
                // Sort: completed first (by date), then incomplete
                quests.sort((a, b) => {
                    if (a.completed !== b.completed) return b.completed - a.completed;
                    if (a.completed && b.completed && a.date && b.date) return a.date.localeCompare(b.date);
                    return a.name.localeCompare(b.name);
                });
                
                const completedCount = quests.filter(q => q.completed).length;
                
                html += `
                    <div class="collection">
                        <div class="collection-header" onclick="this.parentElement.classList.toggle('expanded')">
                            <span class="collection-name">${cat}</span>
                            <span class="collection-count"><span class="obtained">${completedCount}</span> <span class="total">/ ${catData.completed.length + catData.not_completed.length}</span></span>
                        </div>
                        <div class="collection-items">
                            <div class="item-list">
                                ${quests.map(q => `
                                    <div class="item ${q.completed ? 'obtained' : 'missing'}">
                                        <span class="item-check">${q.completed ? '✓' : '○'}</span>
                                        <span class="item-name">${q.name}</span>
                                        ${q.date ? `<span class="item-date">${formatShortDate(q.date)}</span>` : ''}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>`;
            });
            
            list.innerHTML = html || '<div class="empty-state">No quests match your search</div>';
        }

        function getRemainingTasksHtml() {
            const tasks = {
                'Kandarin': [
                    { tier: 'medium', task: '1 Barbarian Assault Wave' },
                    { tier: 'hard', task: '1 Barbarian Assault Queen Kill' },
                    { tier: 'elite', task: '90 Smithing (boost)' },
                    { tier: 'elite', task: 'Chewed Bones (pyre)' },
                    { tier: 'elite', task: 'Barbarian Assault Level 5 in all roles' }
                ],
                'Ardougne': [
                    { tier: 'elite', task: '91 Cooking (boost)' },
                    { tier: 'elite', task: '90 Agility (boost)' },
                    { tier: 'elite', task: '91 Smithing (boost)' }
                ],
                'Desert': [
                    { tier: 'elite', task: '91 Thieving' },
                    { tier: 'elite', task: '85 Prayer' },
                    { tier: 'elite', task: '95 Fletching (boost)' },
                    { tier: 'elite', task: 'KQ Head drop' }
                ],
                'Falador': [
                    { tier: 'elite', task: '80 Runecraft (boost)' },
                    { tier: 'elite', task: 'White 2H Sword (White Knight rank)' }
                ],
                'Fremennik': [
                    { tier: 'elite', task: 'Kill all 3 DKs in one trip' },
                    { tier: 'elite', task: '82 Runecraft (boost)' },
                    { tier: 'elite', task: 'Kill any God Wars General' }
                ],
                'Karamja': [
                    { tier: 'elite', task: '91 Runecraft (boost)' }
                ],
                'Kourend & Kebos': [
                    { tier: 'elite', task: 'Chambers of Xeric completion' }
                ],
                'Morytania': [
                    { tier: 'elite', task: '96 Fishing (boost)' },
                    { tier: 'elite', task: 'Equip full Barrows set' }
                ],
                'Varrock': [
                    { tier: 'elite', task: '95 Cooking (boost)' },
                    { tier: 'elite', task: '89 Smithing (boost)' }
                ],
                'Western Provinces': [
                    { tier: 'elite', task: '85 Agility (boost)' },
                    { tier: 'elite', task: '1,000 Chompy Bird kills' }
                ],
                'Wilderness': [
                    { tier: 'elite', task: '85 Mining / 90 Smithing (boost)' },
                    { tier: 'elite', task: '90 Cooking / 85 Fishing (boost)' },
                    { tier: 'elite', task: 'Kill Callisto, Venenatis & Vet\'ion' }
                ]
            };
            
            return Object.entries(tasks).map(([region, items]) => `
                <div class="task-region">
                    <div class="task-region-header">
                        <span>${region}</span>
                        <span class="task-count">${items.length} task${items.length > 1 ? 's' : ''}</span>
                    </div>
                    <div class="task-items">
                        ${items.map(item => `
                            <div class="task-item">
                                <span>${item.task}</span>
                                <span class="task-tier ${item.tier}">${item.tier}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        function renderDiaries(yaml) {
            const container = document.getElementById('diariesContainer');
            const regions = {};
            let currentRegion = null;
            
            // Parse tasks_completed and tasks_total from header
            let tasksCompleted = 0;
            let tasksTotal = 492;
            
            // Parse YAML
            yaml.split('\n').forEach(line => {
                if (!line || line.startsWith('#')) return;
                
                // Check for tasks_completed/tasks_total
                if (line.startsWith('tasks_completed:')) {
                    tasksCompleted = parseInt(line.split(':')[1].trim()) || 0;
                    return;
                }
                if (line.startsWith('tasks_total:')) {
                    tasksTotal = parseInt(line.split(':')[1].trim()) || 492;
                    return;
                }
                
                // Region line (no leading spaces, ends with :)
                if (!line.startsWith(' ') && line.endsWith(':')) {
                    currentRegion = line.slice(0, -1);
                    regions[currentRegion] = { easy: null, medium: null, hard: null, elite: null };
                }
                // Tier line (has leading spaces)
                else if (currentRegion && line.trim().includes(':')) {
                    const [tier, value] = line.trim().split(':').map(s => s.trim());
                    if (['easy', 'medium', 'hard', 'elite'].includes(tier)) {
                        regions[currentRegion][tier] = value || null;
                    }
                }
            });
            
            // Calculate tier stats
            const tiers = ['easy', 'medium', 'hard', 'elite'];
            let tiersCompleted = 0;
            let tiersTotal = 0;
            const tierCounts = { easy: 0, medium: 0, hard: 0, elite: 0 };
            
            Object.values(regions).forEach(region => {
                tiers.forEach(tier => {
                    tiersTotal++;
                    if (region[tier]) {
                        tiersCompleted++;
                        tierCounts[tier]++;
                    }
                });
            });
            
            const regionCount = Object.keys(regions).length;
            const taskPct = ((tasksCompleted / tasksTotal) * 100).toFixed(1);
            
            // Render
            container.innerHTML = `
                <div class="diaries-summary">
                    <div class="summary-item">
                        <div class="summary-value" style="color: var(--accent-gold)">${tasksCompleted}/${tasksTotal}</div>
                        <div class="summary-label">Tasks (${taskPct}%)</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value" style="color: var(--accent-green)">${tiersCompleted}/${tiersTotal}</div>
                        <div class="summary-label">Tiers Complete</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value" style="color: #22c55e">${tierCounts.easy}/${regionCount}</div>
                        <div class="summary-label">Easy</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value" style="color: #eab308">${tierCounts.medium}/${regionCount}</div>
                        <div class="summary-label">Medium</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value" style="color: #f97316">${tierCounts.hard}/${regionCount}</div>
                        <div class="summary-label">Hard</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value" style="color: #06b6d4">${tierCounts.elite}/${regionCount}</div>
                        <div class="summary-label">Elite</div>
                    </div>
                </div>
                
                <div class="progress-section" style="margin-bottom: 1.5rem;">
                    <div class="progress-header">
                        <span class="progress-title">Overall Task Progress</span>
                        <div class="progress-stats"><span class="obtained">${tasksCompleted}</span><span class="total">/${tasksTotal}</span></div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${taskPct}%"></div>
                    </div>
                    <div class="progress-percentage">${taskPct}% complete · ${tasksTotal - tasksCompleted} tasks remaining</div>
                </div>
                
                <div class="diaries-grid">
                    ${Object.entries(regions).map(([name, tiers]) => {
                        const completed = Object.values(tiers).filter(v => v).length;
                        return `
                            <div class="diary-card">
                                <div class="diary-header">
                                    <span>${name}</span>
                                    <span class="diary-count">${completed}/4</span>
                                </div>
                                <div class="diary-tiers">
                                    ${['easy', 'medium', 'hard', 'elite'].map(tier => `
                                        <div class="diary-tier ${tier} ${tiers[tier] ? 'completed' : ''}">
                                            <div class="tier-name">${tier}</div>
                                            <div class="tier-status">${tiers[tier] ? '✓' : '○'}</div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
                
                <div class="remaining-tasks" id="remainingTasks">
                    <div class="remaining-tasks-header" onclick="document.getElementById('remainingTasks').classList.toggle('expanded')">
                        <h3>📋 Remaining Diary Tasks</h3>
                        <span class="toggle">▼</span>
                    </div>
                    <div class="remaining-tasks-list">
                        ${getRemainingTasksHtml()}
                    </div>
                </div>
            `;
            
            // Store for stat card - now shows tasks, not tiers
            diariesData = { completed: tasksCompleted, total: tasksTotal };
            document.getElementById('diaryCount').textContent = `${tasksCompleted}/${tasksTotal}`;
        }

        // B0aty Guide Functions
        function parseBoatyProgress(yaml) {
            boatyCompleted = new Set();
            let inCompleted = false;
            yaml.split('\n').forEach(line => {
                if (line.trim() === 'completed:') {
                    inCompleted = true;
                    return;
                }
                if (inCompleted && line.trim().startsWith('- ')) {
                    const text = line.trim().slice(2);
                    const parts = text.split(' | ');
                    const stepId = parseInt(parts[0]);
                    if (!isNaN(stepId)) {
                        boatyCompleted.add(stepId);
                    }
                }
            });
        }

        function renderBoatyGuide() {
            const container = document.getElementById('boatyContainer');
            if (!boatyGuide) {
                container.innerHTML = '<div class="boaty-empty">Guide not loaded</div>';
                return;
            }

            const totalSteps = boatyGuide.total_steps;
            const completedCount = boatyCompleted.size;
            const percent = totalSteps > 0 ? Math.round((completedCount / totalSteps) * 100) : 0;

            // Filter episodes based on search and filters
            const filteredEpisodes = filterBoatyEpisodes();
            const visibleSteps = countVisibleSteps(filteredEpisodes);

            container.innerHTML = `
                <div class="boaty-header">
                    <div class="boaty-progress">
                        <div class="progress-item">
                            <div class="progress-value" style="color: var(--accent-green)">${completedCount}/${totalSteps}</div>
                            <div class="progress-label">Steps Complete</div>
                        </div>
                        <div class="progress-item">
                            <div class="progress-value" style="color: var(--accent-gold)">${percent}%</div>
                            <div class="progress-label">Progress</div>
                            <div class="boaty-progress-bar"><div class="boaty-progress-fill" style="width: ${percent}%"></div></div>
                        </div>
                    </div>
                    <a href="${boatyGuide.source}" target="_blank" style="color: var(--accent-gold); font-size: 0.85rem;">📖 View Original Guide</a>
                </div>
                
                <div class="boaty-controls">
                    <input type="text" class="boaty-search" id="boatySearch" placeholder="Search steps..." value="${boatySearchTerm}">
                    <div class="boaty-filters">
                        <button class="boaty-filter ${boatyFilter === 'all' ? 'active' : ''}" data-filter="all">All</button>
                        <button class="boaty-filter ${boatyFilter === 'incomplete' ? 'active' : ''}" data-filter="incomplete">Incomplete</button>
                        <button class="boaty-filter ${boatyFilter === 'completed' ? 'active' : ''}" data-filter="completed">Completed</button>
                    </div>
                    <select class="boaty-search" id="boatyEpisodeFilter" style="flex: 0; min-width: 150px;">
                        <option value="all" ${boatyEpisodeFilter === 'all' ? 'selected' : ''}>All Episodes</option>
                        ${boatyGuide.episodes.map(ep => `
                            <option value="${ep.number}" ${boatyEpisodeFilter == ep.number ? 'selected' : ''}>
                                ${ep.number === 0 ? 'Pre-Guide' : 'Episode ' + ep.number}
                            </option>
                        `).join('')}
                    </select>
                </div>
                
                ${visibleSteps === 0 ? '<div class="boaty-empty">No steps match your filters</div>' : ''}
                
                ${filteredEpisodes.map(ep => {
                    const epSteps = ep.sections.flatMap(s => s.steps);
                    const epCompleted = epSteps.filter(s => boatyCompleted.has(s.id)).length;
                    const epTotal = epSteps.length;
                    if (epTotal === 0) return '';
                    
                    return `
                        <div class="boaty-episode" data-episode="${ep.number}">
                            <div class="boaty-episode-header" onclick="toggleBoatyEpisode(${ep.number})">
                                <h3>${ep.number === 0 ? '🏁 Pre-Guide Setup' : '📺 ' + ep.title}</h3>
                                <div class="episode-stats">
                                    <span class="episode-progress">${epCompleted}/${epTotal}</span>
                                    <span class="episode-toggle">▼</span>
                                </div>
                            </div>
                            <div class="boaty-episode-content">
                                ${ep.sections.map(section => {
                                    const sectionSteps = section.steps;
                                    if (sectionSteps.length === 0) return '';
                                    const sectionCompleted = sectionSteps.filter(s => boatyCompleted.has(s.id)).length;
                                    
                                    return `
                                        <div class="boaty-section">
                                            <div class="boaty-section-header">
                                                <span>${section.name}</span>
                                                <span class="section-count">${sectionCompleted}/${sectionSteps.length}</span>
                                            </div>
                                            ${section.withdraw ? `<div class="boaty-withdraw">📦 ${section.withdraw}</div>` : ''}
                                            <div class="boaty-steps">
                                                ${sectionSteps.map(step => `
                                                    <div class="boaty-step ${boatyCompleted.has(step.id) ? 'completed' : ''}" data-step="${step.id}">
                                                        <div class="step-checkbox">${boatyCompleted.has(step.id) ? '✓' : ''}</div>
                                                        <div class="step-id">#${step.id}</div>
                                                        <div class="step-text">${escapeHtml(step.task)}</div>
                                                    </div>
                                                `).join('')}
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    `;
                }).join('')}
            `;

            // Add event listeners
            document.getElementById('boatySearch').addEventListener('input', (e) => {
                boatySearchTerm = e.target.value;
                renderBoatyGuide();
            });
            
            document.querySelectorAll('.boaty-filter').forEach(btn => {
                btn.addEventListener('click', () => {
                    boatyFilter = btn.dataset.filter;
                    renderBoatyGuide();
                });
            });
            
            document.getElementById('boatyEpisodeFilter').addEventListener('change', (e) => {
                boatyEpisodeFilter = e.target.value;
                renderBoatyGuide();
            });
        }

        function filterBoatyEpisodes() {
            if (!boatyGuide) return [];
            
            return boatyGuide.episodes.map(ep => {
                // Filter by episode
                if (boatyEpisodeFilter !== 'all' && ep.number != boatyEpisodeFilter) {
                    return { ...ep, sections: [] };
                }
                
                const filteredSections = ep.sections.map(section => {
                    const filteredSteps = section.steps.filter(step => {
                        // Filter by completion status
                        if (boatyFilter === 'completed' && !boatyCompleted.has(step.id)) return false;
                        if (boatyFilter === 'incomplete' && boatyCompleted.has(step.id)) return false;
                        
                        // Filter by search term
                        if (boatySearchTerm) {
                            const searchLower = boatySearchTerm.toLowerCase();
                            return step.task.toLowerCase().includes(searchLower) || 
                                   step.id.toString().includes(searchLower);
                        }
                        return true;
                    });
                    return { ...section, steps: filteredSteps };
                }).filter(s => s.steps.length > 0);
                
                return { ...ep, sections: filteredSections };
            }).filter(ep => ep.sections.length > 0);
        }

        function countVisibleSteps(episodes) {
            return episodes.reduce((sum, ep) => 
                sum + ep.sections.reduce((s, sec) => s + sec.steps.length, 0), 0);
        }

        function toggleBoatyEpisode(epNum) {
            const ep = document.querySelector(`.boaty-episode[data-episode="${epNum}"]`);
            if (ep) ep.classList.toggle('expanded');
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function renderGoals(yaml) {
            const container = document.getElementById('goalsContainer');
            const columns = { backlog: [], in_progress: [], blocked: [], completed: [] };
            let current = null;
            
            yaml.split('\n').forEach(line => {
                if (line.startsWith('backlog:')) current = 'backlog';
                else if (line.startsWith('in_progress:')) current = 'in_progress';
                else if (line.startsWith('blocked:')) current = 'blocked';
                else if (line.startsWith('completed:')) current = 'completed';
                else if (current && line.trim().startsWith('- ')) {
                    const text = line.trim().slice(2);
                    const parts = text.split(' | ');
                    columns[current].push({
                        title: parts[0].trim(),
                        date: parts[1]?.trim() || null
                    });
                }
            });

            const columnConfig = [
                { key: 'backlog', label: '📋 Backlog', class: 'backlog' },
                { key: 'in_progress', label: '🔨 In Progress', class: 'in-progress' },
                { key: 'blocked', label: '🚫 Blocked', class: 'blocked' },
                { key: 'completed', label: '✅ Completed', class: 'completed' }
            ];

            container.innerHTML = `
                <div class="kanban-board">
                    ${columnConfig.map(col => `
                        <div class="kanban-column ${col.class}">
                            <div class="kanban-header">
                                <span>${col.label}</span>
                                <span class="count">${columns[col.key].length}</span>
                            </div>
                            <div class="kanban-cards">
                                ${columns[col.key].length ? columns[col.key].map(goal => `
                                    <div class="kanban-card">
                                        <div class="card-title">${goal.title}</div>
                                        ${goal.date ? `<div class="card-date">${formatShortDate(goal.date)}</div>` : ''}
                                    </div>
                                `).join('') : `<div class="kanban-empty">No goals</div>`}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Drops Tab
        let dropsData = [];
        let dropsSearchTerm = '';
        let dropsBossFilter = 'all';
        let luckSummaryData = [];

        const getLuckClass = (luck) => {
            if (luck === 0) return 'luck-pending';
            if (luck >= 2) return 'luck-very-spooned';
            if (luck >= 1.2) return 'luck-spooned';
            if (luck >= 0.8) return 'luck-onrate';
            if (luck >= 0.5) return 'luck-dry';
            return 'luck-very-dry';
        };

        const getStatusClass = (status) => {
            if (status === 'Spooned') return 'status-spooned';
            if (status === 'Dry') return 'status-dry';
            if (status === 'In Progress') return 'status-pending';
            return 'status-onrate';
        };
        let pendingDrops = [];

        function parseDropsYaml(yaml) {
            const drops = [];
            const lines = yaml.split('\n');
            let currentDrop = null;
            
            for (const line of lines) {
                const trimmed = line.trim();
                if (trimmed.startsWith('- boss:')) {
                    if (currentDrop) drops.push(currentDrop);
                    currentDrop = { boss: trimmed.replace('- boss:', '').trim() };
                } else if (currentDrop && trimmed.startsWith('kc:')) {
                    currentDrop.kc = parseInt(trimmed.replace('kc:', '').trim()) || 0;
                } else if (currentDrop && trimmed.startsWith('item:')) {
                    currentDrop.item = trimmed.replace('item:', '').trim();
                } else if (currentDrop && trimmed.startsWith('date:')) {
                    currentDrop.date = trimmed.replace('date:', '').trim() || '';
                } else if (currentDrop && trimmed.startsWith('droprate:')) {
                    currentDrop.droprate = parseInt(trimmed.replace('droprate:', '').trim()) || 0;
                } else if (currentDrop && trimmed.startsWith('notes:')) {
                    currentDrop.notes = trimmed.replace('notes:', '').trim() || '';
                }
            }
            if (currentDrop) drops.push(currentDrop);
            return drops;
        }

        function renderDrops(yaml) {
            dropsData = parseDropsYaml(yaml);
            const container = document.getElementById('dropsContainer');
            
            if (!dropsData.length) {
                container.innerHTML = '<div class="empty-state">No drops data available.</div>';
                return;
            }

            // Get unique bosses for filter
            const bosses = [...new Set(dropsData.map(d => d.boss))].sort();
            
            // Stats
            const totalDrops = dropsData.length;
            const uniqueBosses = bosses.length;

            // Build luck summary from drops that have droprate defined
            const dropsWithRates = dropsData.filter(d => d.droprate);
            luckSummaryData = dropsWithRates.map(drop => {
                const luck = drop.droprate / drop.kc;
                let status = 'On Rate';
                if (luck > 1.2) status = 'Spooned';
                else if (luck < 0.8) status = 'Dry';
                return {
                    activity: drop.boss,
                    drop: drop.item,
                    droprate: drop.droprate,
                    earned: drop.kc,
                    luck,
                    status,
                    notes: drop.notes || ''
                };
            }).sort((a, b) => b.luck - a.luck);

            // Calculate average luck (excluding nulls)
            const validLuck = luckSummaryData.filter(l => l.luck > 0);
            const avgLuck = validLuck.length ? (validLuck.reduce((s, l) => s + l.luck, 0) / validLuck.length) : 0;

            container.innerHTML = `
                <div class="drops-summary">
                    <div class="drops-stat">
                        <div class="drops-stat-value">${totalDrops}</div>
                        <div class="drops-stat-label">Total Drops</div>
                    </div>
                    <div class="drops-stat">
                        <div class="drops-stat-value">${uniqueBosses}</div>
                        <div class="drops-stat-label">Sources</div>
                    </div>
                    <div class="drops-stat">
                        <div class="drops-stat-value">${avgLuck.toFixed(1)}x</div>
                        <div class="drops-stat-label">Avg Luck</div>
                    </div>
                    <div class="drops-stat">
                        <div class="drops-stat-value">${luckSummaryData.filter(l => l.status === 'Spooned').length}</div>
                        <div class="drops-stat-label">Spooned</div>
                    </div>
                    <div class="drops-stat">
                        <div class="drops-stat-value">${luckSummaryData.filter(l => l.status === 'Dry').length}</div>
                        <div class="drops-stat-label">Dry</div>
                    </div>
                </div>

                <div class="drops-filters">
                    <input type="text" class="drops-search" id="dropsSearch" placeholder="Search items or bosses..." value="${dropsSearchTerm}">
                    <select class="drops-filter-select" id="dropsBossFilter">
                        <option value="all">All Sources</option>
                        ${bosses.map(b => `<option value="${b}" ${dropsBossFilter === b ? 'selected' : ''}>${b}</option>`).join('')}
                    </select>
                </div>

                <div class="luck-table-container">
                    <h3>🍀 Luck Summary</h3>
                    <table class="luck-table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Activity</th>
                                <th>Key Drop</th>
                                <th style="text-align:right">KC</th>
                                <th style="text-align:right">Rate</th>
                                <th style="text-align:right">Luck</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="luckTableBody"></tbody>
                    </table>
                </div>

                <div class="drops-count" id="dropsCount"></div>

                <div class="drops-table-container">
                    <table class="drops-table">
                        <thead>
                            <tr>
                                <th>Source</th>
                                <th style="text-align:right">KC</th>
                                <th>Item</th>
                                <th>Date</th>
                                <th>Notes</th>
                            </tr>
                        </thead>
                        <tbody id="dropsTableBody"></tbody>
                    </table>
                </div>

                <div class="drops-add-section">
                    <h3>➕ Add New Drop</h3>
                    <div class="drops-add-form">
                        <input type="text" class="drops-add-input" id="newDropBoss" placeholder="Boss/Source" list="bossList">
                        <datalist id="bossList">
                            ${bosses.map(b => `<option value="${b}">`).join('')}
                        </datalist>
                        <input type="number" class="drops-add-input" id="newDropKc" placeholder="Kill Count">
                        <input type="text" class="drops-add-input" id="newDropItem" placeholder="Item Name">
                        <input type="text" class="drops-add-input" id="newDropDate" placeholder="Date (M/D/YYYY)">
                        <input type="number" class="drops-add-input" id="newDropRate" placeholder="Drop Rate (e.g. 512)">
                        <input type="text" class="drops-add-input" id="newDropNotes" placeholder="Notes (optional)">
                        <button class="drops-add-btn" id="addDropBtn">Add Drop</button>
                    </div>
                    <div class="drops-yaml-output" id="dropsYamlOutput" style="display:none;">
                        <textarea id="dropsYamlText" readonly></textarea>
                        <button class="copy-btn" id="copyYamlBtn">📋 Copy YAML</button>
                    </div>
                </div>
            `;

            // Event listeners
            document.getElementById('dropsSearch').addEventListener('input', (e) => {
                dropsSearchTerm = e.target.value;
                filterDrops();
            });

            document.getElementById('dropsBossFilter').addEventListener('change', (e) => {
                dropsBossFilter = e.target.value;
                filterDrops();
            });

            document.getElementById('addDropBtn').addEventListener('click', addNewDrop);
            document.getElementById('copyYamlBtn').addEventListener('click', () => {
                const textarea = document.getElementById('dropsYamlText');
                textarea.select();
                document.execCommand('copy');
                document.getElementById('copyYamlBtn').textContent = '✓ Copied!';
                setTimeout(() => document.getElementById('copyYamlBtn').textContent = '📋 Copy YAML', 2000);
            });

            filterDrops();
        }

        function filterDrops() {
            const tbody = document.getElementById('dropsTableBody');
            const luckTbody = document.getElementById('luckTableBody');
            const countEl = document.getElementById('dropsCount');
            const searchLower = dropsSearchTerm.toLowerCase();

            // Filter drops table
            let filtered = dropsData.filter(drop => {
                const matchesSearch = !dropsSearchTerm || 
                    drop.boss.toLowerCase().includes(searchLower) || 
                    drop.item.toLowerCase().includes(searchLower) ||
                    (drop.notes && drop.notes.toLowerCase().includes(searchLower));
                const matchesBoss = dropsBossFilter === 'all' || drop.boss === dropsBossFilter;
                return matchesSearch && matchesBoss;
            });

            // Sort by date descending (most recent first), then by KC descending
            filtered.sort((a, b) => {
                const dateA = a.date ? new Date(a.date) : new Date(0);
                const dateB = b.date ? new Date(b.date) : new Date(0);
                if (dateB - dateA !== 0) return dateB - dateA;
                return b.kc - a.kc;
            });

            countEl.textContent = `Showing ${filtered.length} of ${dropsData.length} drops`;

            tbody.innerHTML = filtered.map(drop => `
                <tr>
                    <td class="boss-col">${drop.boss}</td>
                    <td class="kc-col">${drop.kc.toLocaleString()}</td>
                    <td class="item-col">${drop.item}</td>
                    <td class="date-col ${drop.date ? '' : 'missing'}">${drop.date || '—'}</td>
                    <td class="notes-col">${drop.notes || ''}</td>
                </tr>
            `).join('');

            // Filter luck summary table
            let filteredLuck = luckSummaryData.filter(item => {
                const matchesSearch = !dropsSearchTerm || 
                    item.activity.toLowerCase().includes(searchLower) || 
                    item.drop.toLowerCase().includes(searchLower) ||
                    (item.notes && item.notes.toLowerCase().includes(searchLower));
                const matchesBoss = dropsBossFilter === 'all' || item.activity === dropsBossFilter;
                return matchesSearch && matchesBoss;
            });

            // Sort by luck descending
            filteredLuck.sort((a, b) => b.luck - a.luck);

            luckTbody.innerHTML = filteredLuck.map((item, i) => `
                <tr>
                    <td class="rank-col">${i + 1}</td>
                    <td class="activity-col">${item.activity}</td>
                    <td class="drop-col">${item.drop}</td>
                    <td class="kc-col">${item.earned ? item.earned.toLocaleString() : '—'}</td>
                    <td class="rate-col">1/${item.droprate.toLocaleString()}</td>
                    <td class="luck-col ${getLuckClass(item.luck)}">${item.luck ? item.luck.toFixed(1) + 'x' : '—'}</td>
                    <td class="status-col ${getStatusClass(item.status)}">${item.status}</td>
                </tr>
            `).join('');
        }

        function addNewDrop() {
            const boss = document.getElementById('newDropBoss').value.trim();
            const kc = document.getElementById('newDropKc').value.trim();
            const item = document.getElementById('newDropItem').value.trim();
            const date = document.getElementById('newDropDate').value.trim();
            const droprate = document.getElementById('newDropRate').value.trim();
            const notes = document.getElementById('newDropNotes').value.trim();

            if (!boss || !kc || !item) {
                alert('Please fill in Boss, KC, and Item');
                return;
            }

            const newDrop = { boss, kc: parseInt(kc), item, date };
            if (droprate) newDrop.droprate = parseInt(droprate);
            if (notes) newDrop.notes = notes;
            pendingDrops.push(newDrop);

            // Generate YAML
            const yamlLines = pendingDrops.map(d => {
                let yaml = `
  - boss: ${d.boss}
    kc: ${d.kc}
    item: ${d.item}
    date: ${d.date}`;
                if (d.droprate) yaml += `\n    droprate: ${d.droprate}`;
                if (d.notes) yaml += `\n    notes: ${d.notes}`;
                return yaml;
            }).join('\n');

            document.getElementById('dropsYamlText').value = `# Add to data/drops.yaml:\n${yamlLines}`;
            document.getElementById('dropsYamlOutput').style.display = 'block';

            // Clear inputs
            document.getElementById('newDropBoss').value = '';
            document.getElementById('newDropKc').value = '';
            document.getElementById('newDropItem').value = '';
            document.getElementById('newDropDate').value = '';
            document.getElementById('newDropRate').value = '';

            // Add to displayed data temporarily
            dropsData.push(newDrop);
            filterDrops();
        }

        // Progression Tab
        function renderProgression(dropsYaml) {
            const container = document.getElementById('progressionContainer');
            const drops = dropsYaml ? parseDropsYaml(dropsYaml) : [];
            
            // Helper to check if we have a drop
            const hasDrop = (itemName) => drops.some(d => d.item.toLowerCase().includes(itemName.toLowerCase()));
            const hasAnyDrop = (itemNames) => itemNames.some(n => hasDrop(n));
            
            // Helper to check skill level
            const skillLevel = (name) => skillsData?.[name]?.level || 1;
            const hasSkillLevel = (name, level) => skillLevel(name) >= level;
            
            // Helper to check boss KC
            const bossKc = (name) => {
                if (!bossesData) return 0;
                const boss = Object.entries(bossesData).find(([k]) => k.toLowerCase().includes(name.toLowerCase()));
                return boss ? boss[1].kc : 0;
            };
            const hasBossKc = (name, kc) => bossKc(name) >= kc;
            
            // Helper to check quest completion
            const hasQuest = (name) => {
                if (!questsData?.categories) return false;
                const nameLower = name.toLowerCase();
                for (const cat of Object.values(questsData.categories)) {
                    if (cat.completed) {
                        const found = cat.completed.some(q => {
                            const questName = typeof q === 'string' ? q : q.name;
                            return questName.toLowerCase().includes(nameLower);
                        });
                        if (found) return true;
                    }
                }
                return false;
            };

            // Define milestones for each phase
            const phases = [
                {
                    name: 'Early Game',
                    phase: 'early',
                    icon: '🌱',
                    description: 'Building your foundation',
                    milestones: [
                        { name: 'Fire Cape', detail: 'Fight Caves', check: () => hasDrop('Fire Cape'), type: 'drop' },
                        { name: 'Barrows Gloves', detail: 'Recipe for Disaster', check: () => hasQuest('Recipe for Disaster'), type: 'quest' },
                        { name: 'Fighter Torso', detail: 'Barbarian Assault', check: () => hasDrop('Fighter Torso') || true, type: 'gear' },
                        { name: 'Dragon Defender', detail: 'Warriors Guild', check: () => hasDrop('Dragon Defender') || hasSkillLevel('Attack', 70), type: 'gear' },
                        { name: 'Iban\'s Staff', detail: 'Underground Pass', check: () => hasQuest('Underground Pass') || true, type: 'quest' },
                        { name: 'Berserker Ring', detail: 'Dagannoth Rex', check: () => hasDrop('Berserker Ring'), type: 'drop' },
                        { name: '70 Prayer', detail: 'Piety unlocked', check: () => hasSkillLevel('Prayer', 70), type: 'skill' },
                        { name: '75 Magic', detail: 'Trident access', check: () => hasSkillLevel('Magic', 75), type: 'skill' },
                        { name: 'Full Barrows Set', detail: 'Any brother', check: () => drops.filter(d => d.boss === 'Barrows').length >= 4, type: 'drop' },
                        { name: 'Quest Cape', detail: 'All quests done', check: () => questsData?.total_completed >= 158, type: 'quest' },
                    ]
                },
                {
                    name: 'Mid Game',
                    phase: 'mid',
                    icon: '⚔️',
                    description: 'Gearing up for end game',
                    milestones: [
                        { name: 'Trident of the Seas', detail: 'Kraken', check: () => hasDrop('Trident') || hasBossKc('Kraken', 50), type: 'drop' },
                        { name: 'Abyssal Whip', detail: 'Abyssal Demons', check: () => hasDrop('Abyssal Whip'), type: 'drop' },
                        { name: 'Dragon Warhammer', detail: 'Lizardman Shamans', check: () => hasDrop('Dragon Warhammer'), type: 'drop' },
                        { name: 'Zenyte Jewelry', detail: 'Demonic Gorillas', check: () => hasDrop('Zenyte'), type: 'drop' },
                        { name: 'Occult Necklace', detail: 'Smoke Devils', check: () => hasDrop('Occult') || hasSkillLevel('Slayer', 93), type: 'drop' },
                        { name: '87 Slayer', detail: 'Kraken unlocked', check: () => hasSkillLevel('Slayer', 87), type: 'skill' },
                        { name: '91 Slayer', detail: 'Cerberus unlocked', check: () => hasSkillLevel('Slayer', 91), type: 'skill' },
                        { name: 'Elite Void', detail: 'Pest Control + diaries', check: () => true, type: 'gear' },
                        { name: 'Dragon Pickaxe', detail: 'Wildy bosses', check: () => hasDrop('Dragon Pickaxe'), type: 'drop' },
                        { name: 'Imbued Heart', detail: 'Superior Slayer', check: () => hasDrop('Imbued Heart'), type: 'drop' },
                    ]
                },
                {
                    name: 'Late Game',
                    phase: 'late',
                    icon: '🔮',
                    description: 'High-level PvM unlocks',
                    milestones: [
                        { name: 'Blade of Saeldor', detail: 'Corrupted Gauntlet', check: () => hasDrop('Enhanced crystal weapon seed') || hasDrop('Blade of Saeldor'), type: 'drop' },
                        { name: 'Bowfa', detail: 'Corrupted Gauntlet', check: () => hasDrop('Enhanced crystal weapon seed'), type: 'drop' },
                        { name: 'Full Crystal Armor', detail: '6 armor seeds', check: () => drops.filter(d => d.item.includes('Crystal armour seed')).length >= 6, type: 'drop' },
                        { name: 'Primordial Boots', detail: 'Cerberus', check: () => hasDrop('Primordial crystal'), type: 'drop' },
                        { name: 'Pegasian Boots', detail: 'Cerberus', check: () => hasDrop('Pegasian crystal'), type: 'drop' },
                        { name: 'Eternal Boots', detail: 'Cerberus', check: () => hasDrop('Eternal crystal'), type: 'drop' },
                        { name: 'Infernal Cape', detail: 'The Inferno', check: () => hasDrop('Infernal Cape'), type: 'drop' },
                        { name: 'Tormented Bracelet', detail: 'Zenyte + enchant', check: () => drops.filter(d => d.item.includes('Zenyte')).length >= 2, type: 'gear' },
                        { name: 'Necklace of Anguish', detail: 'Zenyte + enchant', check: () => drops.filter(d => d.item.includes('Zenyte')).length >= 3, type: 'gear' },
                        { name: '95+ Slayer', detail: 'Hydra unlocked', check: () => hasSkillLevel('Slayer', 95), type: 'skill' },
                    ]
                },
                {
                    name: 'End Game',
                    phase: 'end',
                    icon: '👑',
                    description: 'Ultimate goals',
                    milestones: [
                        { name: 'Twisted Bow', detail: 'Chambers of Xeric', check: () => hasDrop('Twisted Bow'), type: 'drop' },
                        { name: 'Scythe of Vitur', detail: 'Theatre of Blood', check: () => hasDrop('Scythe'), type: 'drop' },
                        { name: 'Tumeken\'s Shadow', detail: 'Tombs of Amascut', check: () => hasDrop('Tumeken'), type: 'drop' },
                        { name: 'Torva Armor', detail: 'Nex', check: () => hasAnyDrop(['Torva platebody', 'Torva platelegs', 'Torva helm']), type: 'drop' },
                        { name: 'Masori Armor', detail: 'Tombs of Amascut', check: () => hasAnyDrop(['Masori body', 'Masori chaps', 'Masori mask']), type: 'drop' },
                        { name: 'Max Cape', detail: 'All 99s', check: () => skillsData && Object.values(skillsData).every(s => s.level >= 99), type: 'skill' },
                        { name: 'Grandmaster CAs', detail: 'All GM tasks', check: () => caData?.tiers?.Grandmaster?.completed === caData?.tiers?.Grandmaster?.total, type: 'achievement' },
                        { name: 'All Pets', detail: 'Gotta catch em all', check: () => petsData?.total_obtained >= 50, type: 'collection' },
                        { name: 'Completionist', detail: 'Collection log', check: () => clogData?.total_obtained >= 1400, type: 'collection' },
                        { name: 'All Hard Diaries', detail: 'Every region', check: () => true, type: 'achievement' },
                    ]
                }
            ];

            // Calculate stats
            let totalMilestones = 0;
            let completedMilestones = 0;
            phases.forEach(phase => {
                phase.milestones.forEach(m => {
                    totalMilestones++;
                    m.complete = m.check();
                    if (m.complete) completedMilestones++;
                });
                phase.completed = phase.milestones.filter(m => m.complete).length;
                phase.total = phase.milestones.length;
                phase.percent = Math.round((phase.completed / phase.total) * 100);
            });

            // Determine current phase
            let currentPhase = 'Early Game';
            if (phases[0].percent >= 80) currentPhase = 'Mid Game';
            if (phases[1].percent >= 80) currentPhase = 'Late Game';
            if (phases[2].percent >= 80) currentPhase = 'End Game';

            const overallPercent = Math.round((completedMilestones / totalMilestones) * 100);

            const getTypeIcon = (type) => {
                const icons = { drop: '💎', skill: '📊', quest: '📜', gear: '🛡️', achievement: '🏆', collection: '📚' };
                return icons[type] || '✓';
            };

            container.innerHTML = `
                <div class="progression-header">
                    <h2>Ironman Progression</h2>
                    <p>Currently in: <strong>${currentPhase}</strong></p>
                </div>

                <div class="progression-stats">
                    <div class="prog-stat">
                        <div class="prog-stat-value">${overallPercent}%</div>
                        <div class="prog-stat-label">Overall</div>
                    </div>
                    <div class="prog-stat">
                        <div class="prog-stat-value">${completedMilestones}/${totalMilestones}</div>
                        <div class="prog-stat-label">Milestones</div>
                    </div>
                    <div class="prog-stat">
                        <div class="prog-stat-value">${skillsData ? Object.entries(skillsData).filter(([k, s]) => k !== 'Overall' && s.level >= 99).length : 0}</div>
                        <div class="prog-stat-label">99s</div>
                    </div>
                    <div class="prog-stat">
                        <div class="prog-stat-value">${drops.length}</div>
                        <div class="prog-stat-label">Notable Drops</div>
                    </div>
                    <div class="prog-stat">
                        <div class="prog-stat-value">${petsData?.total_obtained || 0}</div>
                        <div class="prog-stat-label">Pets</div>
                    </div>
                </div>

                <div class="progression-phases">
                    ${phases.map(phase => `
                        <div class="phase ${phase.phase}">
                            <div class="phase-header">
                                <div class="phase-title">
                                    <span class="phase-icon">${phase.icon}</span>
                                    <span class="phase-name">${phase.name}<span>${phase.description}</span></span>
                                </div>
                                <div class="phase-progress">
                                    <div class="phase-progress-bar">
                                        <div class="phase-progress-fill" style="width: ${phase.percent}%"></div>
                                    </div>
                                    <span class="phase-progress-text">${phase.percent}%</span>
                                </div>
                            </div>
                            <div class="phase-content">
                                <div class="milestone-grid">
                                    ${phase.milestones.map(m => `
                                        <div class="milestone ${m.complete ? 'complete' : 'incomplete'}">
                                            <span class="milestone-icon">${m.complete ? '✓' : getTypeIcon(m.type)}</span>
                                            <div class="milestone-info">
                                                <div class="milestone-name">${m.name}</div>
                                                <div class="milestone-detail">${m.detail}</div>
                                            </div>
                                            <span class="milestone-status ${m.complete ? 'done' : ''}">${m.complete ? 'Done' : '—'}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        let bankData = null;
        let bankSearchTerm = '';
        let bankCategoryFilter = 'all';
        let bankSubcategoryFilter = 'all';

        function renderBank(data, potionStorage, seedVault) {
            bankData = data;
            const container = document.getElementById('bankContainer');
            
            // Calculate storage values
            let potionValue = 0;
            let potionVials = 0;
            if (potionStorage?.items) {
                potionStorage.items.forEach(item => {
                    const vials = Math.floor(item.doses / 4);
                    potionValue += vials * item.ge_price;
                    potionVials += vials;
                });
            }
            
            let seedValue = 0;
            let seedCount = 0;
            if (seedVault?.items) {
                seedVault.items.forEach(item => {
                    seedValue += item.quantity * item.ge_price;
                    seedCount += item.quantity;
                });
            }
            
            const totalCombinedValue = (data?.total_value || 0) + potionValue + seedValue;
            
            // Update stat card with combined value
            const formatGpShort = (value) => {
                if (value >= 1000000000) return (value / 1000000000).toFixed(1) + 'B';
                if (value >= 1000000) return (value / 1000000).toFixed(0) + 'M';
                if (value >= 1000) return (value / 1000).toFixed(0) + 'K';
                return value.toString();
            };
            document.getElementById('bankValueCard').textContent = formatGpShort(totalCombinedValue);
            
            const formatGp = (value) => {
                if (value >= 1000000000) return (value / 1000000000).toFixed(2) + 'B';
                if (value >= 1000000) return (value / 1000000).toFixed(2) + 'M';
                if (value >= 1000) return (value / 1000).toFixed(1) + 'K';
                return value.toLocaleString();
            };

            if (!data || !data.items) {
                container.innerHTML = '<div class="empty-state">No bank data available. Update data/bank.txt with your Bank Memory export, then commit and push.</div>';
                return;
            }

            // Get unique categories for filter
            const categories = [...new Set(data.items.map(i => i.category))].sort();

            container.innerHTML = `
                <div class="bank-updated">
                    <div>🏦 Bank: ${formatDate(data.updated)}</div>
                    ${potionStorage ? `<div>🧪 Potion Storage: ${potionStorage.last_updated} (${potionVials.toLocaleString()} vials)</div>` : ''}
                    ${seedVault ? `<div>🌱 Seed Vault: ${seedVault.last_updated} (${seedCount.toLocaleString()} seeds)</div>` : ''}
                </div>
                
                <div class="bank-summary">
                    <div class="bank-summary-card highlight">
                        <div class="bank-summary-label">Total Combined Value</div>
                        <div class="bank-summary-value">${formatGp(totalCombinedValue)} gp</div>
                    </div>
                    <div class="bank-summary-card">
                        <div class="bank-summary-label">Bank Value</div>
                        <div class="bank-summary-value">${formatGp(data.total_value)} gp</div>
                    </div>
                    <div class="bank-summary-card">
                        <div class="bank-summary-label">Potion Storage</div>
                        <div class="bank-summary-value">${formatGp(potionValue)} gp</div>
                    </div>
                    <div class="bank-summary-card">
                        <div class="bank-summary-label">Seed Vault</div>
                        <div class="bank-summary-value">${formatGp(seedValue)} gp</div>
                    </div>
                    <div class="bank-summary-card">
                        <div class="bank-summary-label">Unique Items</div>
                        <div class="bank-summary-value green">${data.total_items.toLocaleString()}</div>
                    </div>
                    <div class="bank-summary-card">
                        <div class="bank-summary-label">Total Quantity</div>
                        <div class="bank-summary-value">${data.total_quantity.toLocaleString()}</div>
                    </div>
                </div>

                <div class="bank-top-items">
                    <h3>💰 Most Valuable Items</h3>
                    ${data.top_items.map((item, i) => `
                        <div class="top-item">
                            <span class="top-item-name">${i + 1}. ${item.name}<span class="top-item-qty">x${item.quantity.toLocaleString()}</span></span>
                            <span class="top-item-value">${formatGp(item.total_value)} gp</span>
                        </div>
                    `).join('')}
                </div>

                <div class="bank-category-breakdown">
                    <h3>📊 Value by Category</h3>
                    <div class="category-cards" id="categoryCards">
                        ${generateCategoryCards(data)}
                    </div>
                </div>

                <div class="bank-filters">
                    <input type="text" class="bank-search" id="bankSearch" placeholder="Search items..." value="${bankSearchTerm}">
                    <select class="bank-filter-select" id="bankCategoryFilter">
                        <option value="all">All Categories</option>
                        ${categories.map(cat => `<option value="${cat}" ${bankCategoryFilter === cat ? 'selected' : ''}>${cat}</option>`).join('')}
                    </select>
                    <select class="bank-filter-select" id="bankSubcategoryFilter">
                        <option value="all">All Subcategories</option>
                    </select>
                </div>

                <div class="bank-filter-stats" id="bankFilterStats"></div>

                <div class="bank-all-items">
                    <h3>📦 All Items</h3>
                    <div class="bank-items-grid" id="bankItemsGrid"></div>
                </div>
            `;

            // Add event listeners
            document.getElementById('bankSearch').addEventListener('input', (e) => {
                bankSearchTerm = e.target.value;
                filterBankItems();
                updateCategoryCardSelection();
            });

            document.getElementById('bankCategoryFilter').addEventListener('change', (e) => {
                bankCategoryFilter = e.target.value;
                bankSubcategoryFilter = 'all';
                updateSubcategoryFilter();
                filterBankItems();
                updateCategoryCardSelection();
            });

            document.getElementById('bankSubcategoryFilter').addEventListener('change', (e) => {
                bankSubcategoryFilter = e.target.value;
                filterBankItems();
            });

            // Add click listeners for category cards
            document.querySelectorAll('.category-card').forEach(card => {
                card.addEventListener('click', () => {
                    const category = card.dataset.category;
                    if (bankCategoryFilter === category) {
                        // Clicking same category deselects it
                        bankCategoryFilter = 'all';
                    } else {
                        bankCategoryFilter = category;
                    }
                    bankSubcategoryFilter = 'all';
                    document.getElementById('bankCategoryFilter').value = bankCategoryFilter;
                    updateSubcategoryFilter();
                    filterBankItems();
                    updateCategoryCardSelection();
                });
            });

            updateSubcategoryFilter();
            filterBankItems();
            updateCategoryCardSelection();
        }

        function getCategoryClass(category) {
            return 'cat-' + category.toLowerCase().replace(/[^a-z0-9]/g, '-').replace(/-+/g, '-');
        }

        function generateCategoryCards(data) {
            const formatGp = (value) => {
                if (value >= 1000000000) return (value / 1000000000).toFixed(2) + 'B';
                if (value >= 1000000) return (value / 1000000).toFixed(1) + 'M';
                if (value >= 1000) return (value / 1000).toFixed(0) + 'K';
                return value.toLocaleString();
            };

            // Aggregate by category
            const categoryStats = {};
            data.items.forEach(item => {
                if (!categoryStats[item.category]) {
                    categoryStats[item.category] = { count: 0, quantity: 0, value: 0 };
                }
                categoryStats[item.category].count++;
                categoryStats[item.category].quantity += item.quantity;
                categoryStats[item.category].value += item.total_value;
            });

            // Sort by value descending
            const sortedCategories = Object.entries(categoryStats)
                .sort((a, b) => b[1].value - a[1].value);

            return sortedCategories.map(([category, stats]) => `
                <div class="category-card ${getCategoryClass(category)}" data-category="${category}">
                    <div class="category-card-name">${category}</div>
                    <div class="category-card-stats">
                        <span class="category-card-count">${stats.count} items</span>
                        <span class="category-card-value">${formatGp(stats.value)}</span>
                    </div>
                </div>
            `).join('');
        }

        function updateCategoryCardSelection() {
            document.querySelectorAll('.category-card').forEach(card => {
                if (bankCategoryFilter === 'all') {
                    card.classList.remove('active');
                } else if (card.dataset.category === bankCategoryFilter) {
                    card.classList.add('active');
                } else {
                    card.classList.remove('active');
                }
            });
        }

        function updateSubcategoryFilter() {
            if (!bankData) return;
            
            const subcatSelect = document.getElementById('bankSubcategoryFilter');
            let subcategories = [];
            
            if (bankCategoryFilter === 'all') {
                subcategories = [...new Set(bankData.items.map(i => i.subcategory))].sort();
            } else {
                subcategories = [...new Set(
                    bankData.items
                        .filter(i => i.category === bankCategoryFilter)
                        .map(i => i.subcategory)
                )].sort();
            }

            subcatSelect.innerHTML = `
                <option value="all">All Subcategories</option>
                ${subcategories.map(sub => `<option value="${sub}" ${bankSubcategoryFilter === sub ? 'selected' : ''}>${sub}</option>`).join('')}
            `;
        }

        function filterBankItems() {
            if (!bankData) return;

            const grid = document.getElementById('bankItemsGrid');
            const statsDiv = document.getElementById('bankFilterStats');
            const searchLower = bankSearchTerm.toLowerCase();

            let filteredItems = bankData.items.filter(item => {
                const matchesSearch = !bankSearchTerm || item.name.toLowerCase().includes(searchLower);
                const matchesCategory = bankCategoryFilter === 'all' || item.category === bankCategoryFilter;
                const matchesSubcategory = bankSubcategoryFilter === 'all' || item.subcategory === bankSubcategoryFilter;
                return matchesSearch && matchesCategory && matchesSubcategory;
            });

            // Calculate stats for filtered items
            const filteredCount = filteredItems.length;
            const filteredQty = filteredItems.reduce((sum, i) => sum + i.quantity, 0);
            const filteredValue = filteredItems.reduce((sum, i) => sum + i.total_value, 0);

            // Sort by value descending
            filteredItems.sort((a, b) => b.total_value - a.total_value);

            const formatGp = (value) => {
                if (value >= 1000000000) return (value / 1000000000).toFixed(2) + 'B';
                if (value >= 1000000) return (value / 1000000).toFixed(2) + 'M';
                if (value >= 1000) return (value / 1000).toFixed(1) + 'K';
                return value.toLocaleString();
            };

            // Show filter stats
            const isFiltered = bankSearchTerm || bankCategoryFilter !== 'all' || bankSubcategoryFilter !== 'all';
            if (isFiltered) {
                statsDiv.innerHTML = `
                    <div class="filter-stats-row">
                        <span class="filter-stat"><strong>${filteredCount}</strong> items</span>
                        <span class="filter-stat"><strong>${filteredQty.toLocaleString()}</strong> total qty</span>
                        <span class="filter-stat"><strong>${formatGp(filteredValue)}</strong> gp value</span>
                    </div>
                `;
                statsDiv.style.display = 'block';
            } else {
                statsDiv.style.display = 'none';
            }

            if (filteredItems.length === 0) {
                grid.innerHTML = '<div class="no-results">No items found matching your filters.</div>';
                return;
            }

            grid.innerHTML = filteredItems.map(item => `
                <div class="bank-item">
                    <span class="bank-item-name">${item.name}</span>
                    <span class="bank-item-qty">x${item.quantity.toLocaleString()}</span>
                    <span class="bank-item-value">${formatGp(item.total_value)}</span>
                </div>
            `).join('');
        }

        // Password hashing function
        async function hashPassword(password) {
            const encoder = new TextEncoder();
            const data = encoder.encode(password);
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }

        // Show password modal
        function showPasswordModal(targetTabId) {
            const modal = document.getElementById('passwordModal');
            const input = document.getElementById('bankPassword');
            const error = document.getElementById('passwordError');
            
            modal.classList.add('active');
            input.value = '';
            error.textContent = '';
            input.focus();
            
            // Store target tab for after unlock
            modal.dataset.targetTab = targetTabId;
        }

        // Hide password modal
        function hidePasswordModal() {
            const modal = document.getElementById('passwordModal');
            modal.classList.remove('active');
            modal.dataset.targetTab = '';
        }

        // Check password and unlock
        async function checkPassword() {
            const input = document.getElementById('bankPassword');
            const error = document.getElementById('passwordError');
            const modal = document.getElementById('passwordModal');
            
            // Check if password protection is configured
            if (!BANK_PASSWORD_HASH) {
                error.textContent = 'Password protection not configured';
                return;
            }
            
            // Direct comparison (no hashing - secret IS the password)
            if (input.value === BANK_PASSWORD_HASH) {
                bankUnlocked = true;
                sessionStorage.setItem('bankUnlocked', 'true');
                hidePasswordModal();
                
                // Switch to the protected tab
                const targetTab = modal.dataset.targetTab;
                if (targetTab) {
                    document.getElementById(targetTab).classList.remove('locked');
                    switchTabDirect(targetTab);
                }
            } else {
                error.textContent = 'Incorrect password';
                input.value = '';
                input.focus();
            }
        }

        // Direct tab switch (no password check)
        function switchTabDirect(tabId) {
            document.querySelectorAll('.nav-tab').forEach(x => x.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(x => x.classList.remove('active'));
            const tab = document.querySelector(`.nav-tab[data-tab="${tabId}"]`);
            if (tab) {
                tab.classList.add('active');
                document.getElementById(tabId).classList.add('active');
            }
        }

        // Tab switch with password protection
        function switchTab(tabId) {
            // Check if this is the protected tab
            if (tabId === PROTECTED_TAB_ID) {
                // Check if already unlocked this session
                if (bankUnlocked || sessionStorage.getItem('bankUnlocked') === 'true') {
                    bankUnlocked = true;
                    document.getElementById(tabId).classList.remove('locked');
                    switchTabDirect(tabId);
                } else {
                    // Show password modal
                    document.getElementById(tabId).classList.add('locked');
                    showPasswordModal(tabId);
                }
            } else {
                switchTabDirect(tabId);
            }
        }

        // Password modal event listeners
        document.getElementById('passwordSubmit').addEventListener('click', checkPassword);
        document.getElementById('passwordCancel').addEventListener('click', () => {
            hidePasswordModal();
            // Go back to previous tab or skills
            window.location.hash = 'skills';
            switchTabDirect('skills');
        });
        document.getElementById('bankPassword').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') checkPassword();
        });

        document.querySelectorAll('.nav-tab').forEach(t => t.addEventListener('click', () => {
            const tabId = t.dataset.tab;
            window.location.hash = tabId;
            switchTab(tabId);
        }));

        // Stat card click handlers
        document.querySelectorAll('.stat-card[data-tab]').forEach(card => card.addEventListener('click', () => {
            const tabId = card.dataset.tab;
            window.location.hash = tabId;
            switchTab(tabId);
        }));

        // Handle initial load and back/forward navigation
        function handleHashChange() {
            const hash = window.location.hash.slice(1);
            if (hash && document.getElementById(hash)) {
                switchTab(hash);
            }
        }
        window.addEventListener('hashchange', handleHashChange);
        window.addEventListener('load', handleHashChange);

        loadData();
    </script>
</body>
</html>
